<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link href="https://gmpg.org/xfn/11" rel="profile"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5GDZWWBRFX"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-5GDZWWBRFX');
                </script><link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://rusith.me/icons/favicon-144-image.png"/><link rel="shortcut icon" href="https://rusith.me/favicon.ico"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/><meta property="twitter:creator" content="@rusith_"/><meta name="robots" content="index,follow"/><title>Creating a Re-Usable Presto Worker Image in EC2</title><meta name="description" content="Creating a machine image that can be used to spin up presto worker instances without configuring each one. this could be helpful when you don&#x27;t want to use any  orchestration tool"/><link rel="canonical" href="https://rusith.me/blog/re-usable-presto-worker-image-ec2"/><meta property="og:title" content="Creating a Re-Usable Presto Worker Image in EC2"/><meta property="og:url" content="https://rusith.me/blog/re-usable-presto-worker-image-ec2"/><meta property="og:description" content="Creating a machine image that can be used to spin up presto worker instances without configuring each one. this could be helpful when you don&#x27;t want to use any  orchestration tool"/><meta property="og:site_name" content="Rusith&#x27;s blog"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="blog"/><meta property="twitter:description" content="Demonstrates how to create a re-usable Presto worker image using a AWS EC2 instance"/><meta property="og:image" content="/post-data/2019-07-25-re-usable-presto-worker/5-workers-dashboard.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Creating a Re-Usable Presto Worker Image in EC2"/><meta name="twitter:image" content="/post-data/2019-07-25-re-usable-presto-worker/5-workers-dashboard.png"/><meta name="twitter:site" content="@rusith_"/><script type="application/ld+json">{"@type":"BlogPosting","@context":"https://schema.org","headline":"Creating a Re-Usable Presto Worker Image in EC2","author":{"@type":"Person","name":"Shanaka Rusith","url":"https://rusith.me/about"},"keywords":"programming,bigdata,aws,cloud","url":"https://rusith.me/blog/re-usable-presto-worker-image-ec2","description":"Creating a machine image that can be used to spin up presto worker instances without configuring each one. this could be helpful when you don't want to use any  orchestration tool","copyrightHolder":{"@type":"Person","name":"Shanaka Rusith","url":"https://rusith.me/about"},"copyrightYear":"2021","mainEntityOfPage":{"@type":"WebPage","@id":"https://rusith.me"},"publisher":{"@type":"Organization","name":"Shanaka Rusith","url":"https://rusith.me/about","logo":{"@type":"ImageObject","url":"https://rusith.me/images/rusith/picture.jpg"}},"image":"/post-data/2019-07-25-re-usable-presto-worker/5-workers-dashboard.png","about":"Demonstrates how to create a re-usable Presto worker image using a AWS EC2 instance","datePublished":"Thu Jul 25 2019 00:00:00 GMT+0000 (Coordinated Universal Time)","dateModified":"Thu Jul 25 2019 00:00:00 GMT+0000 (Coordinated Universal Time)"}</script><meta name="next-head-count" content="27"/><link rel="preload" href="/_next/static/css/7220332d6168fb06.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7220332d6168fb06.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0662676664ee362f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0662676664ee362f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-05c0aa1e498fcb8c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f89480c30d9a5d02.js" defer=""></script><script src="/_next/static/chunks/947-277c090e7d6803d0.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...path%5D%5D-d5cf2aa81a49e144.js" defer=""></script><script src="/_next/static/PaoTT2YDvwYY_jbobaNoC/_buildManifest.js" defer=""></script><script src="/_next/static/PaoTT2YDvwYY_jbobaNoC/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="Sidebar_r__IEuUi"><div class="Sidebar_sticky__RE23V"><div class="Sidebar_about__s_kM6"><h2><a href="/">Rusith.me</a></h2><div class="Sidebar_socialButtons__XcH6p"><a href="https://www.linkedin.com/in/shanaka-rusith" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="LinkedIn icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MTYsMzJIMzEuOUMxNC4zLDMyLDAsNDYuNSwwLDY0LjN2MzgzLjRDMCw0NjUuNSwxNC4zLDQ4MCwzMS45LDQ4MEg0MTZjMTcuNiwwLDMyLTE0LjUsMzItMzIuM1Y2NC4zCglDNDQ4LDQ2LjUsNDMzLjYsMzIsNDE2LDMyeiBNMTM1LjQsNDE2SDY5VjIwMi4yaDY2LjVWNDE2SDEzNS40eiBNMTAyLjIsMTczYy0yMS4zLDAtMzguNS0xNy4zLTM4LjUtMzguNVM4MC45LDk2LDEwMi4yLDk2CgljMjEuMiwwLDM4LjUsMTcuMywzOC41LDM4LjVDMTQwLjcsMTU1LjgsMTIzLjUsMTczLDEwMi4yLDE3M3ogTTM4NC4zLDQxNmgtNjYuNFYzMTJjMC0yNC44LTAuNS01Ni43LTM0LjUtNTYuNwoJYy0zNC42LDAtMzkuOSwyNy0zOS45LDU0LjlWNDE2aC02Ni40VjIwMi4yaDYzLjd2MjkuMmgwLjljOC45LTE2LjgsMzAuNi0zNC41LDYyLjktMzQuNWM2Ny4yLDAsNzkuNyw0NC4zLDc5LjcsMTAxLjlWNDE2eiIvPgo8L3N2Zz4K"/></a><a href="https://github.com/rusith" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="Github icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MDAsMzJINDhDMjEuNSwzMiwwLDUzLjUsMCw4MHYzNTJjMCwyNi41LDIxLjUsNDgsNDgsNDhoMzUyYzI2LjUsMCw0OC0yMS41LDQ4LTQ4VjgwCglDNDQ4LDUzLjUsNDI2LjUsMzIsNDAwLDMyeiBNMjc3LjMsNDE1LjdjLTguNCwxLjUtMTEuNS0zLjctMTEuNS04YzAtNS40LDAuMi0zMywwLjItNTUuM2MwLTE1LjYtNS4yLTI1LjUtMTEuMy0zMC43CgljMzctNC4xLDc2LTkuMiw3Ni03My4xYzAtMTguMi02LjUtMjcuMy0xNy4xLTM5YzEuNy00LjMsNy40LTIyLTEuNy00NWMtMTMuOS00LjMtNDUuNywxNy45LTQ1LjcsMTcuOWMtMTMuMi0zLjctMjcuNS01LjYtNDEuNi01LjYKCXMtMjguNCwxLjktNDEuNiw1LjZjMCwwLTMxLjgtMjIuMi00NS43LTE3LjljLTkuMSwyMi45LTMuNSw0MC42LTEuNyw0NWMtMTAuNiwxMS43LTE1LjYsMjAuOC0xNS42LDM5YzAsNjMuNiwzNy4zLDY5LDc0LjMsNzMuMQoJYy00LjgsNC4zLTkuMSwxMS43LTEwLjYsMjIuM2MtOS41LDQuMy0zMy44LDExLjctNDguMy0xMy45Yy05LjEtMTUuOC0yNS41LTE3LjEtMjUuNS0xNy4xYy0xNi4yLTAuMi0xLjEsMTAuMi0xLjEsMTAuMgoJYzEwLjgsNSwxOC40LDI0LjIsMTguNCwyNC4yYzkuNywyOS43LDU2LjEsMTkuNyw1Ni4xLDE5LjdjMCwxMy45LDAuMiwzNi41LDAuMiw0MC42YzAsNC4zLTMsOS41LTExLjUsOAoJYy02Ni0yMi4xLTExMi4yLTg0LjktMTEyLjItMTU4LjNjMC05MS44LDcwLjItMTYxLjUsMTYyLTE2MS41UzM4OCwxNjUuNiwzODgsMjU3LjRDMzg4LjEsMzMwLjgsMzQzLjMsMzkzLjcsMjc3LjMsNDE1Ljd6CgkgTTE3OS4yLDM1NC42Yy0xLjksMC40LTMuNy0wLjQtMy45LTEuN2MtMC4yLTEuNSwxLjEtMi44LDMtMy4yYzEuOS0wLjIsMy43LDAuNiwzLjksMS45QzE4Mi41LDM1Mi45LDE4MS4yLDM1NC4yLDE3OS4yLDM1NC42CglMMTc5LjIsMzU0LjZ6IE0xNjkuNywzNTMuN2MwLDEuMy0xLjUsMi40LTMuNSwyLjRjLTIuMiwwLjItMy43LTAuOS0zLjctMi40YzAtMS4zLDEuNS0yLjQsMy41LTIuNAoJQzE2Ny45LDM1MS4xLDE2OS43LDM1Mi4yLDE2OS43LDM1My43eiBNMTU2LDM1Mi42Yy0wLjQsMS4zLTIuNCwxLjktNC4xLDEuM2MtMS45LTAuNC0zLjItMS45LTIuOC0zLjJjMC40LTEuMywyLjQtMS45LDQuMS0xLjUKCUMxNTUuMiwzNDkuOCwxNTYuNSwzNTEuMywxNTYsMzUyLjZMMTU2LDM1Mi42eiBNMTQzLjcsMzQ3LjJjLTAuOSwxLjEtMi44LDAuOS00LjMtMC42Yy0xLjUtMS4zLTEuOS0zLjItMC45LTQuMQoJYzAuOS0xLjEsMi44LTAuOSw0LjMsMC42QzE0NC4xLDM0NC40LDE0NC42LDM0Ni40LDE0My43LDM0Ny4yeiBNMTM0LjYsMzM4LjFjLTAuOSwwLjYtMi42LDAtMy43LTEuNXMtMS4xLTMuMiwwLTMuOQoJYzEuMS0wLjksMi44LTAuMiwzLjcsMS4zQzEzNS43LDMzNS41LDEzNS43LDMzNy4zLDEzNC42LDMzOC4xeiBNMTI4LjEsMzI4LjRjLTAuOSwwLjktMi40LDAuNC0zLjUtMC42Yy0xLjEtMS4zLTEuMy0yLjgtMC40LTMuNQoJYzAuOS0wLjksMi40LTAuNCwzLjUsMC42QzEyOC44LDMyNi4yLDEyOSwzMjcuNywxMjguMSwzMjguNHogTTEyMS40LDMyMWMtMC40LDAuOS0xLjcsMS4xLTIuOCwwLjRjLTEuMy0wLjYtMS45LTEuNy0xLjUtMi42CgljMC40LTAuNiwxLjUtMC45LDIuOC0wLjRDMTIxLjIsMzE5LjEsMTIxLjgsMzIwLjIsMTIxLjQsMzIxeiIvPgo8L3N2Zz4K"/></a><a href="https://gitlab.com/rusith" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="Gitlab icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUuMiwyNC45Yy0zLjEtOC45LTE1LjctOC45LTE4LjksMEwyOS44LDE5OS43aDEzMkMxNjEuNywxOTkuNywxMDUuMiwyNC45LDEwNS4yLDI0Ljl6IE0wLjksMjg3LjcKCWMtMi42LDgsMC4zLDE2LjksNy4xLDIybDI0Ny45LDE4NGwtMjI2LjItMjk0TDAuOSwyODcuN3ogTTE2MS43LDE5OS43bDk0LjMsMjk0bDk0LjMtMjk0SDE2MS43eiBNNTExLjEsMjg3LjdsLTI4LjgtODhMMjU2LDQ5My43CglsMjQ3LjktMTg0QzUxMC44LDMwNC42LDUxMy42LDI5NS43LDUxMS4xLDI4Ny43eiBNNDI1LjcsMjQuOWMtMy4xLTguOS0xNS43LTguOS0xOC45LDBsLTU2LjYsMTc0LjhoMTMyTDQyNS43LDI0Ljl6Ii8+Cjwvc3ZnPgo="/></a><a href="http://goodreads.com/rusith" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="GoodReads icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0yOTkuOSwxOTEuMmM1LjEsMzcuMy00LjcsNzktMzUuOSwxMDAuN2MtMjIuMywxNS41LTUyLjgsMTQuMS03MC44LDUuN2MtMzcuMS0xNy4zLTQ5LjUtNTguNi00Ni44LTk3LjIKCWM0LjMtNjAuOSw0MC45LTg3LjksNzUuMy04Ny41QzI2OC42LDExMi43LDI5My41LDE0NC43LDI5OS45LDE5MS4yTDI5OS45LDE5MS4yeiBNNDQ4LDg4djMzNmMwLDMwLjktMjUuMSw1Ni01Niw1Nkg1NgoJYy0zMC45LDAtNTYtMjUuMS01Ni01NlY4OGMwLTMwLjksMjUuMS01Niw1Ni01NmgzMzZDNDIyLjksMzIsNDQ4LDU3LjEsNDQ4LDg4eiBNMzMwLDMxMy4yYzAsMC0wLjEtMzQtMC4xLTIxNy4zaC0yOXY0MC4zCgljLTAuOCwwLjMtMS4yLTAuNS0xLjYtMS4yYy05LjYtMjAuNy0zNS45LTQ2LjMtNzYtNDZjLTUxLjksMC40LTg3LjIsMzEuMi0xMDAuNiw3Ny44Yy00LjMsMTQuOS01LjgsMzAuMS01LjUsNDUuNgoJYzEuNyw3Ny45LDQ1LjEsMTE3LjgsMTEyLjQsMTE1LjJjMjguOS0xLjEsNTQuNS0xNyw2OS00NS4yYzAuNS0xLDEuMS0xLjksMS43LTIuOWMwLjIsMC4xLDAuNCwwLjEsMC42LDAuMgoJYzAuMywzLjgsMC4yLDMwLjcsMC4xLDM0LjVjLTAuMiwxNC44LTIsMjkuNS03LjIsNDMuNWMtNy44LDIxLTIyLjMsMzQuNy00NC41LDM5LjVjLTE3LjgsMy45LTM1LjYsMy44LTUzLjItMS4yCgljLTIxLjUtNi4xLTM2LjUtMTktNDEuMS00MS44Yy0wLjMtMS42LTEuMy0xLjMtMi4zLTEuM2gtMjYuOGMwLjgsMTAuNiwzLjIsMjAuMyw4LjUsMjkuMmMyNC4yLDQwLjUsODIuNyw0OC41LDEyOC4yLDM3LjQKCUMzMTIuNSw0MDcuMiwzMjkuOSwzNjQuNiwzMzAsMzEzLjJMMzMwLDMxMy4yeiIvPgo8L3N2Zz4K"/></a><a href="https://twitter.com/rusith_" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="Twitter icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MDAsMzJINDhDMjEuNSwzMiwwLDUzLjUsMCw4MHYzNTJjMCwyNi41LDIxLjUsNDgsNDgsNDhoMzUyYzI2LjUsMCw0OC0yMS41LDQ4LTQ4VjgwCglDNDQ4LDUzLjUsNDI2LjUsMzIsNDAwLDMyeiBNMzUxLjEsMTkwLjhjMC4yLDIuOCwwLjIsNS43LDAuMiw4LjVjMCw4Ni43LTY2LDE4Ni42LTE4Ni42LDE4Ni42Yy0zNy4yLDAtNzEuNy0xMC44LTEwMC43LTI5LjQKCWM1LjMsMC42LDEwLjQsMC44LDE1LjgsMC44YzMwLjcsMCw1OC45LTEwLjQsODEuNC0yOGMtMjguOC0wLjYtNTMtMTkuNS02MS4zLTQ1LjVjMTAuMSwxLjUsMTkuMiwxLjUsMjkuNi0xLjIKCWMtMzAtNi4xLTUyLjUtMzIuNS01Mi41LTY0LjR2LTAuOGM4LjcsNC45LDE4LjksNy45LDI5LjYsOC4zYy0xOC4zLTEyLjItMjkuMi0zMi43LTI5LjItNTQuNmMwLTEyLjIsMy4yLTIzLjQsOC45LTMzLjEKCWMzMi4zLDM5LjgsODAuOCw2NS44LDEzNS4yLDY4LjZjLTkuMy00NC41LDI0LTgwLjYsNjQtODAuNmMxOC45LDAsMzUuOSw3LjksNDcuOSwyMC43YzE0LjgtMi44LDI5LTguMyw0MS42LTE1LjgKCWMtNC45LDE1LjItMTUuMiwyOC0yOC44LDM2LjFjMTMuMi0xLjQsMjYtNS4xLDM3LjgtMTAuMkMzNzUuMSwxNjkuOSwzNjMuOSwxODEuNSwzNTEuMSwxOTAuOHoiLz4KPC9zdmc+Cg=="/></a><a href="https://www.facebook.com/shanaka.rusith" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="Facebook icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MDAsMzJINDhDMjEuNSwzMiwwLDUzLjUsMCw4MHYzNTJjMCwyNi41LDIxLjUsNDgsNDgsNDhoMTM3LjNWMzI3LjdoLTYzVjI1Nmg2M3YtNTQuNgoJYzAtNjIuMiwzNy05Ni41LDkzLjctOTYuNWMyNy4xLDAsNTUuNSw0LjgsNTUuNSw0Ljh2NjFoLTMxLjNjLTMwLjgsMC00MC40LDE5LjEtNDAuNCwzOC43VjI1Nmg2OC44bC0xMSw3MS43aC01Ny44VjQ4MEg0MDAKCWMyNi41LDAsNDgtMjEuNSw0OC00OFY4MEM0NDgsNTMuNSw0MjYuNSwzMiw0MDAsMzJ6Ii8+Cjwvc3ZnPgo="/></a></div><p>A blog from a tech and art enthusiast</p></div><div class="Sidebar_nav__CTYKS"><div class="Sidebar_tagWrapper__w460D"><a href="/tag/programming/"><span class="Sidebar_tag__mAo8y">#<!-- -->programming</span></a><a href="/tag/aws/"><span class="Sidebar_tag__mAo8y">#<!-- -->aws</span></a><a href="/tag/web/"><span class="Sidebar_tag__mAo8y">#<!-- -->web</span></a><a href="/tag/machineLearning/"><span class="Sidebar_tag__mAo8y">#<!-- -->machineLearning</span></a><a href="/tag/react/"><span class="Sidebar_tag__mAo8y">#<!-- -->react</span></a><a href="/tag/javascript/"><span class="Sidebar_tag__mAo8y">#<!-- -->javascript</span></a><a href="/tag/dataScience/"><span class="Sidebar_tag__mAo8y">#<!-- -->dataScience</span></a><a href="/tag/typescript/"><span class="Sidebar_tag__mAo8y">#<!-- -->typescript</span></a><a href="/tag/r/"><span class="Sidebar_tag__mAo8y">#<!-- -->r</span></a><a href="/tag/csharp/"><span class="Sidebar_tag__mAo8y">#<!-- -->csharp</span></a></div></div></div></div><div class="comp_content__73ns2"><div><h1>Creating a Re-Usable Presto Worker Image in EC2</h1><div class="Post_tags__HKWUb"><a class="Post_tag__5GXoX" href="https://rusith.me/tag/programming">#<!-- -->programming</a><a class="Post_tag__5GXoX" href="https://rusith.me/tag/bigdata">#<!-- -->bigdata</a><a class="Post_tag__5GXoX" href="https://rusith.me/tag/aws">#<!-- -->aws</a><a class="Post_tag__5GXoX" href="https://rusith.me/tag/cloud">#<!-- -->cloud</a></div><span class="Post_date__h8Of6">Thu, Jul 25, 2019</span><div><p>When you have to create a Presto cluster, managing a lot of workers is a pain. So people have built different tools around it to make this easy. but when you don't have any tool like that for the rescue, you can use this approach to set up a machine image that can be used to run as many workers as you want without doing any configuration on each machine.</p>
<p>Okay, first you need to get this right on one instance.</p>
<p>Before you begin, make sure</p>
<ul>
<li>That you have a working coordinator instance.</li>
<li>You have a security group for your coordinator node</li>
</ul>
<p>Okay, Assuming you have a working coordinator node, let's start creating our Presto worker image.</p>
<p>Create a security group for the worker nodes and allow traffic from the coordinator and allow traffic from the same security group. Also, edit the coordinator group to allow traffic from the worker group.</p>
<p><img alt="Coordinator config" src="https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/sg-coordinator.png"></p>
<p><img alt="Worker config" src="https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/sg-worker.png"></p>
<p>Okay, Now our security rules are ready. lets install Presto.
Spin up a node and connect to it.</p>
<p>Now we can download and install Presto. (copy the latest version link from the Presto website)</p>
<pre><code class="hljs sh language-sh"><span class="hljs-built_in">cd</span> ~
wget https://repo1.maven.org/maven2/io/prestosql/presto-server/316/presto-server-316.tar.gz -O ./presto.tar.gz
tar -xvzf presto.tar.gz <span class="hljs-comment"># extract the archive</span>
<span class="hljs-built_in">mv</span> ./presto-server-316 ./presto <span class="hljs-comment">#move to the ~/presto folder</span>
<span class="hljs-built_in">rm</span> ./presto.tar.gz
</code></pre>
<p>Okay, Now we should install the required tools which are Java and Python.</p>
<pre><code class="hljs sh language-sh"><span class="hljs-comment"># Installing Java</span>
sudo apt-get update
sudo apt-get install openjdk-8-jdk

<span class="hljs-comment"># Install Python</span>
sudo apt install python2.7 python-pip
</code></pre>
<p>Let's also create the missing <code>data</code> folder for Presto.</p>
<pre><code class="hljs sh language-sh"><span class="hljs-built_in">mkdir</span> ~/presto/data
</code></pre>
<p>With that done, we can now configure Presto installation.</p>
<p>Create a the file <code>~/presto/etc/node.properties</code>.</p>
<pre><code class="hljs conf language-conf"><span class="hljs-attr">node.environment</span>=production
<span class="hljs-attr">node.id</span>=ffffffff-ffff-ffff-ffff-ffffffffffff
<span class="hljs-attr">node.data-dir</span>=~/presto/data
</code></pre>
<p>Create the file <code>~/presto/etc/jvm.config</code>.</p>
<pre><code>-server
-Xmx16G
-XX:+UseG1GC
-XX:G1HeapRegionSize=32M
-XX:+UseGCOverheadLimit
-XX:+ExplicitGCInvokesConcurrent
-XX:+HeapDumpOnOutOfMemoryError
-XX:+ExitOnOutOfMemoryError
</code></pre>
<p>Create the file <code>~/presto/etc/config.properties</code> (replace the coordinator ip)</p>
<pre><code class="hljs conf language-conf"><span class="hljs-attr">coordinator</span>=<span class="hljs-literal">false</span>
<span class="hljs-attr">http-server.http.port</span>=<span class="hljs-number">8081</span>
<span class="hljs-attr">discovery.uri</span>=http://&lt;coordinator ip&gt;:<span class="hljs-number">8081</span>
</code></pre>
<p>You can also configure catalogs at this time.</p>
<p>Now give it a try by running Presto.</p>
<pre><code class="hljs sh language-sh"><span class="hljs-built_in">cd</span> ~/presto/bin
./launcher run
</code></pre>
<p>If you get the service started message. you are ready to go ahead. you can stop Presto service now.</p>
<p>Here comes the interesting part. in the <code>node.properties</code> file, we have the value <code>ffffffff-ffff-ffff-ffff-ffffffffffff</code>. actually, this value should be a GUID.</p>
<p>So what we are going to do is to auto-generate a GUID and replace this value when the system is starting. and run Presto as a service.</p>
<p>Let's create a script that will run at startup and start Presto service.</p>
<p>create the file <code>~/runpresto.sh</code> and put the content</p>
<pre><code class="hljs sh language-sh"><span class="hljs-meta">#!/bin/sh -</span>
<span class="hljs-comment"># Replace the placeholder with a GUID</span>
sed -i <span class="hljs-string">&quot;s/ffffffff-ffff-ffff-ffff-ffffffffffff/<span class="hljs-subst">$(uuidgen)</span>/&quot;</span> /home/ubuntu/presto/etc/node.properties
<span class="hljs-comment"># Run presto</span>
/home/ubuntu/presto/bin/launcher run
</code></pre>
<p>And make the file runnable.</p>
<pre><code class="hljs sh language-sh"><span class="hljs-built_in">chmod</span> u+x ~/runpresto.sh
</code></pre>
<p>Now we can run this script at startup. for that, we can use <code>systemd</code>.
Let's create a service file for Presto.</p>
<p>Create the file <code>/etc/systemd/system/presto.service</code>.</p>
<pre><code class="hljs conf language-conf"><span class="hljs-attr">Description</span>=Presto Worker

<span class="hljs-section">[Service]</span>
<span class="hljs-attr">ExecStart</span>=/home/ubuntu/runpresto.sh
<span class="hljs-attr">RemainAfterExit</span>=<span class="hljs-literal">no</span>
<span class="hljs-attr">Restart</span>=<span class="hljs-literal">on</span>-failure
<span class="hljs-attr">RestartSec</span>=<span class="hljs-number">5</span>s

<span class="hljs-section">[Install]</span>
<span class="hljs-attr">WantedBy</span>=multi-user.targer
</code></pre>
<p>Here we say the service should re-start in 5 seconds if failed.
Now we can register our service.</p>
<p>run <code>sudo systemctl daemon-reload</code> and
<code>sudo systemctl enable presto.service</code> to make the script run at startup.</p>
<p>Restart the instance and Wait few seconds and run <code>sudo systemctl status presto.service</code> to see if the service is running.</p>
<p><img alt="Presto Service Running" src="https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/presto-running.png"></p>
<p>you can also check the Presto dashboard to see if the worker is connected.</p>
<p><img alt="Presto Service Running" src="https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/one-worker.png"></p>
<p>Now, stop the instance and create a machine image from it.</p>
<p><img alt="Presto Service Running" src="https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/worker-image.png"></p>
<p>Now you can use this machine image to run as many workers you want.</p>
<p>Here, I have started 5 workers.</p>
<p><img alt="Presto Service Running" src="https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/5-workers-console.png"></p>
<p>And all workers are connected and ready to use.</p>
<p><img alt="Presto Service Running" src="https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/5-workers-dashboard.png"></p></div></div><div class="Post_related__V0k3K"><h2>Related Posts</h2><ul class="Post_relatedPosts__co9O7"><li><h3><a href="https://rusith.me/blog/deploy-app-on-aws-ecs-with-cdk-auto-scaling-and-load-balancing">Deploying an app on AWS ECS with CDK<small>Wed, Feb 15, 2023</small></a></h3></li><li><h3><a href="https://rusith.me/blog/nuget-feed-on-s3">Running a Nuget Feed on S3 with Automated Deployments<small>Sat, Nov 2, 2019</small></a></h3></li><li><h3><a href="https://rusith.me/blog/building-a-website-on-s3">Deploying a Website on S3 With SSL, Continuous Integration<small>Mon, Aug 5, 2019</small></a></h3></li></ul></div><div id="disqus_thread"></div></div><div class="sbuttons"><a href="https://www.facebook.com/sharer/sharer.php?u=https://rusith.me/blog/re-usable-presto-worker-image-ec2" target="_blank" class="sbutton fb" title="Share on Facebook" rel="noreferrer"><img alt="Facebook icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAzMjAgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAzMjAgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0yNzkuMSwyODhsMTQuMi05Mi43aC04OC45di02MC4xYzAtMjUuMywxMi40LTUwLjEsNTIuMi01MC4xaDQwLjRWNi4zYzAsMC0zNi43LTYuMy03MS43LTYuMwoJYy03My4yLDAtMTIxLjEsNDQuNC0xMjEuMSwxMjQuN3Y3MC42SDIyLjlWMjg4aDgxLjR2MjI0aDEwMC4yVjI4OEgyNzkuMXoiLz4KPC9zdmc+Cg=="/></a><a href="https://twitter.com/intent/tweet?text=https://rusith.me/blog/re-usable-presto-worker-image-ec2" target="_blank" class="sbutton twitt" title="Share on Twitter" rel="noreferrer"><img alt="Twitter icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00NTkuNCwxNTEuN2MwLjMsNC41LDAuMyw5LjEsMC4zLDEzLjZjMCwxMzguNy0xMDUuNiwyOTguNi0yOTguNiwyOTguNmMtNTkuNSwwLTExNC43LTE3LjItMTYxLjEtNDcuMQoJYzguNCwxLDE2LjYsMS4zLDI1LjMsMS4zYzQ5LjEsMCw5NC4yLTE2LjYsMTMwLjMtNDQuOGMtNDYuMS0xLTg0LjgtMzEuMi05OC4xLTcyLjhjNi41LDEsMTMsMS42LDE5LjgsMS42YzkuNCwwLDE4LjgtMS4zLDI3LjYtMy42CgljLTQ4LjEtOS43LTg0LjEtNTItODQuMS0xMDN2LTEuM2MxNCw3LjgsMzAuMiwxMi43LDQ3LjQsMTMuM2MtMjguMy0xOC44LTQ2LjgtNTEtNDYuOC04Ny40YzAtMTkuNSw1LjItMzcuNCwxNC4zLTUzCglDODcuNCwxMzAuOSwxNjUsMTcyLjUsMjUyLjEsMTc3LjFjLTEuNi03LjgtMi42LTE1LjktMi42LTI0YzAtNTcuOCw0Ni44LTEwNC45LDEwNC45LTEwNC45YzMwLjIsMCw1Ny41LDEyLjcsNzYuNywzMy4xCgljMjMuNy00LjUsNDYuNS0xMy4zLDY2LjYtMjUuM2MtNy44LDI0LjQtMjQuNCw0NC44LTQ2LjEsNTcuOGMyMS4xLTIuMyw0MS42LTguMSw2MC40LTE2LjJDNDk3LjcsMTE4LjMsNDc5LjgsMTM2LjgsNDU5LjQsMTUxLjcKCUw0NTkuNCwxNTEuN3oiLz4KPC9zdmc+Cg=="/></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://rusith.me/blog/re-usable-presto-worker-image-ec2&amp;title=&amp;summary=&amp;source=" target="_blank" class="sbutton linkedin" title="Share on Linkedin" rel="noreferrer"><img alt="LinkedIn icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDAuMyw0NDhINy40VjE0OC45aDkyLjlWNDQ4eiBNNTMuOCwxMDguMUMyNC4xLDEwOC4xLDAsODMuNSwwLDUzLjhDMCwyNC4xLDI0LjEsMCw1My44LDAKCWMyOS43LDAsNTMuOCwyNC4xLDUzLjgsNTMuOEMxMDcuNiw4My41LDgzLjUsMTA4LjEsNTMuOCwxMDguMXogTTQ0Ny45LDQ0OGgtOTIuN1YzMDIuNGMwLTM0LjctMC43LTc5LjItNDguMy03OS4yCgljLTQ4LjMsMC01NS43LDM3LjctNTUuNyw3Ni43VjQ0OGgtOTIuOFYxNDguOWg4OS4xdjQwLjhoMS4zYzEyLjQtMjMuNSw0Mi43LTQ4LjMsODcuOS00OC4zYzk0LDAsMTExLjMsNjEuOSwxMTEuMywxNDIuM1Y0NDhINDQ3Ljl6CgkiLz4KPC9zdmc+Cg=="/></a><a target="_blank" class="sbutton mainsbutton"><img alt="Share button" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0zNTIsMzIwYy0yNS42LDAtNDguOSwxMC02Ni4xLDI2LjRsLTk4LjMtNjEuNWM1LjktMTguOCw1LjktMzkuMSwwLTU3LjhsOTguMy02MS41CglDMzAzLjEsMTgyLDMyNi40LDE5MiwzNTIsMTkyYzUzLDAsOTYtNDMsOTYtOTZTNDA1LDAsMzUyLDBzLTk2LDQzLTk2LDk2YzAsOS44LDEuNSwxOS42LDQuNCwyOC45bC05OC4zLDYxLjUKCUMxNDQuOSwxNzAsMTIxLjYsMTYwLDk2LDE2MGMtNTMsMC05Niw0My05Niw5NnM0Myw5Niw5Niw5NmMyNS42LDAsNDguOS0xMCw2Ni4xLTI2LjRsOTguMyw2MS41Yy0yLjksOS40LTQuNCwxOS4xLTQuNCwyOC45CgljMCw1Myw0Myw5Niw5Niw5NnM5Ni00Myw5Ni05NlM0MDUsMzIwLDM1MiwzMjBMMzUyLDMyMHogTTM1Miw0OGMyNi41LDAsNDgsMjEuNSw0OCw0OHMtMjEuNSw0OC00OCw0OHMtNDgtMjEuNS00OC00OAoJUzMyNS41LDQ4LDM1Miw0OHogTTk2LDMwNGMtMjYuNSwwLTQ4LTIxLjUtNDgtNDhzMjEuNS00OCw0OC00OHM0OCwyMS41LDQ4LDQ4UzEyMi41LDMwNCw5NiwzMDR6IE0zNTIsNDY0Yy0yNi41LDAtNDgtMjEuNS00OC00OAoJczIxLjUtNDgsNDgtNDhzNDgsMjEuNSw0OCw0OFMzNzguNSw0NjQsMzUyLDQ2NHoiLz4KPC9zdmc+Cg=="/></a></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"fileName":"2019-07-25-re-usable-presto-worker-image.md","fullPath":"/home/runner/work/rusith.me/rusith.me/modules/blog/posts/2019-07-25-re-usable-presto-worker-image.md","title":"Creating a Re-Usable Presto Worker Image in EC2","tags":["programming","bigdata","aws","cloud"],"comments":true,"description":"Creating a machine image that can be used to spin up presto worker instances without configuring each one. this could be helpful when you don't want to use any  orchestration tool","dateCreated":"Thu Jul 25 2019 00:00:00 GMT+0000 (Coordinated Universal Time)","dateModified":"Thu Jul 25 2019 00:00:00 GMT+0000 (Coordinated Universal Time)","datePublished":"Thu Jul 25 2019 00:00:00 GMT+0000 (Coordinated Universal Time)","dependencies":"AWS","about":"Demonstrates how to create a re-usable Presto worker image using a AWS EC2 instance","banner":"/post-data/2019-07-25-re-usable-presto-worker/5-workers-dashboard.png","path":"/blog/re-usable-presto-worker-image-ec2","oldPath":"/2019/07/25/re-usable-presto-worker-image","dateCreatedFormatted":"Thu, Jul 25, 2019","fullUrl":"https://rusith.me/blog/re-usable-presto-worker-image-ec2","fileContent":"---\ntitle: Creating a Re-Usable Presto Worker Image in EC2\ntags: programming bigdata aws cloud\ncomments: true\ndescription: Creating a machine image that can be used to spin up presto worker instances without configuring each one. this could be helpful when you don't want to use any  orchestration tool\ndateCreated: 2019-07-25\ndateModified: 2019-07-25\ndatePublished: 2019-07-25\ndependencies: AWS\nabout: Demonstrates how to create a re-usable Presto worker image using a AWS EC2 instance\nbanner: /post-data/2019-07-25-re-usable-presto-worker/5-workers-dashboard.png\npath: /re-usable-presto-worker-image-ec2\noldPath: /2019/07/25/re-usable-presto-worker-image\n---\n\nWhen you have to create a Presto cluster, managing a lot of workers is a pain. So people have built different tools around it to make this easy. but when you don't have any tool like that for the rescue, you can use this approach to set up a machine image that can be used to run as many workers as you want without doing any configuration on each machine.\n\nOkay, first you need to get this right on one instance.\n\nBefore you begin, make sure\n\n- That you have a working coordinator instance.\n- You have a security group for your coordinator node\n\nOkay, Assuming you have a working coordinator node, let's start creating our Presto worker image.\n\nCreate a security group for the worker nodes and allow traffic from the coordinator and allow traffic from the same security group. Also, edit the coordinator group to allow traffic from the worker group.\n\n\u003cimg alt=\"Coordinator config\" src=\"$$base_url/post-data/2019-07-25-re-usable-presto-worker/sg-coordinator.png\"\u003e\n\n\u003cimg alt=\"Worker config\" src=\"$$base_url/post-data/2019-07-25-re-usable-presto-worker/sg-worker.png\"\u003e\n\nOkay, Now our security rules are ready. lets install Presto.\nSpin up a node and connect to it.\n\nNow we can download and install Presto. (copy the latest version link from the Presto website)\n\n```sh\ncd ~\nwget https://repo1.maven.org/maven2/io/prestosql/presto-server/316/presto-server-316.tar.gz -O ./presto.tar.gz\ntar -xvzf presto.tar.gz # extract the archive\nmv ./presto-server-316 ./presto #move to the ~/presto folder\nrm ./presto.tar.gz\n```\n\nOkay, Now we should install the required tools which are Java and Python.\n\n```sh\n# Installing Java\nsudo apt-get update\nsudo apt-get install openjdk-8-jdk\n\n# Install Python\nsudo apt install python2.7 python-pip\n```\n\nLet's also create the missing `data` folder for Presto.\n\n```sh\nmkdir ~/presto/data\n```\n\nWith that done, we can now configure Presto installation.\n\nCreate a the file `~/presto/etc/node.properties`.\n\n```conf\nnode.environment=production\nnode.id=ffffffff-ffff-ffff-ffff-ffffffffffff\nnode.data-dir=~/presto/data\n```\n\nCreate the file `~/presto/etc/jvm.config`.\n\n```\n-server\n-Xmx16G\n-XX:+UseG1GC\n-XX:G1HeapRegionSize=32M\n-XX:+UseGCOverheadLimit\n-XX:+ExplicitGCInvokesConcurrent\n-XX:+HeapDumpOnOutOfMemoryError\n-XX:+ExitOnOutOfMemoryError\n```\n\nCreate the file `~/presto/etc/config.properties` (replace the coordinator ip)\n\n```conf\ncoordinator=false\nhttp-server.http.port=8081\ndiscovery.uri=http://\u003ccoordinator ip\u003e:8081\n```\n\nYou can also configure catalogs at this time.\n\nNow give it a try by running Presto.\n\n```sh\ncd ~/presto/bin\n./launcher run\n```\n\nIf you get the service started message. you are ready to go ahead. you can stop Presto service now.\n\nHere comes the interesting part. in the `node.properties` file, we have the value `ffffffff-ffff-ffff-ffff-ffffffffffff`. actually, this value should be a GUID.\n\nSo what we are going to do is to auto-generate a GUID and replace this value when the system is starting. and run Presto as a service.\n\nLet's create a script that will run at startup and start Presto service.\n\ncreate the file `~/runpresto.sh` and put the content\n\n```sh\n#!/bin/sh -\n# Replace the placeholder with a GUID\nsed -i \"s/ffffffff-ffff-ffff-ffff-ffffffffffff/$(uuidgen)/\" /home/ubuntu/presto/etc/node.properties\n# Run presto\n/home/ubuntu/presto/bin/launcher run\n```\n\nAnd make the file runnable.\n\n```sh\nchmod u+x ~/runpresto.sh\n```\n\nNow we can run this script at startup. for that, we can use `systemd`.\nLet's create a service file for Presto.\n\nCreate the file `/etc/systemd/system/presto.service`.\n\n```conf\nDescription=Presto Worker\n\n[Service]\nExecStart=/home/ubuntu/runpresto.sh\nRemainAfterExit=no\nRestart=on-failure\nRestartSec=5s\n\n[Install]\nWantedBy=multi-user.targer\n```\n\nHere we say the service should re-start in 5 seconds if failed.\nNow we can register our service.\n\nrun `sudo systemctl daemon-reload` and\n`sudo systemctl enable presto.service` to make the script run at startup.\n\nRestart the instance and Wait few seconds and run `sudo systemctl status presto.service` to see if the service is running.\n\n\u003cimg alt=\"Presto Service Running\" src=\"$$base_url/post-data/2019-07-25-re-usable-presto-worker/presto-running.png\"\u003e\n\nyou can also check the Presto dashboard to see if the worker is connected.\n\n\u003cimg alt=\"Presto Service Running\" src=\"$$base_url/post-data/2019-07-25-re-usable-presto-worker/one-worker.png\"\u003e\n\nNow, stop the instance and create a machine image from it.\n\n\u003cimg alt=\"Presto Service Running\" src=\"$$base_url/post-data/2019-07-25-re-usable-presto-worker/worker-image.png\"\u003e\n\nNow you can use this machine image to run as many workers you want.\n\nHere, I have started 5 workers.\n\n\u003cimg alt=\"Presto Service Running\" src=\"$$base_url/post-data/2019-07-25-re-usable-presto-worker/5-workers-console.png\"\u003e\n\nAnd all workers are connected and ready to use.\n\n\u003cimg alt=\"Presto Service Running\" src=\"$$base_url/post-data/2019-07-25-re-usable-presto-worker/5-workers-dashboard.png\"\u003e\n","parsedContent":"\u003cp\u003eWhen you have to create a Presto cluster, managing a lot of workers is a pain. So people have built different tools around it to make this easy. but when you don't have any tool like that for the rescue, you can use this approach to set up a machine image that can be used to run as many workers as you want without doing any configuration on each machine.\u003c/p\u003e\n\u003cp\u003eOkay, first you need to get this right on one instance.\u003c/p\u003e\n\u003cp\u003eBefore you begin, make sure\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThat you have a working coordinator instance.\u003c/li\u003e\n\u003cli\u003eYou have a security group for your coordinator node\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eOkay, Assuming you have a working coordinator node, let's start creating our Presto worker image.\u003c/p\u003e\n\u003cp\u003eCreate a security group for the worker nodes and allow traffic from the coordinator and allow traffic from the same security group. Also, edit the coordinator group to allow traffic from the worker group.\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Coordinator config\" src=\"https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/sg-coordinator.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Worker config\" src=\"https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/sg-worker.png\"\u003e\u003c/p\u003e\n\u003cp\u003eOkay, Now our security rules are ready. lets install Presto.\nSpin up a node and connect to it.\u003c/p\u003e\n\u003cp\u003eNow we can download and install Presto. (copy the latest version link from the Presto website)\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs sh language-sh\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e ~\nwget https://repo1.maven.org/maven2/io/prestosql/presto-server/316/presto-server-316.tar.gz -O ./presto.tar.gz\ntar -xvzf presto.tar.gz \u003cspan class=\"hljs-comment\"\u003e# extract the archive\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003emv\u003c/span\u003e ./presto-server-316 ./presto \u003cspan class=\"hljs-comment\"\u003e#move to the ~/presto folder\u003c/span\u003e\n\u003cspan class=\"hljs-built_in\"\u003erm\u003c/span\u003e ./presto.tar.gz\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOkay, Now we should install the required tools which are Java and Python.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs sh language-sh\"\u003e\u003cspan class=\"hljs-comment\"\u003e# Installing Java\u003c/span\u003e\nsudo apt-get update\nsudo apt-get install openjdk-8-jdk\n\n\u003cspan class=\"hljs-comment\"\u003e# Install Python\u003c/span\u003e\nsudo apt install python2.7 python-pip\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eLet's also create the missing \u003ccode\u003edata\u003c/code\u003e folder for Presto.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs sh language-sh\"\u003e\u003cspan class=\"hljs-built_in\"\u003emkdir\u003c/span\u003e ~/presto/data\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWith that done, we can now configure Presto installation.\u003c/p\u003e\n\u003cp\u003eCreate a the file \u003ccode\u003e~/presto/etc/node.properties\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs conf language-conf\"\u003e\u003cspan class=\"hljs-attr\"\u003enode.environment\u003c/span\u003e=production\n\u003cspan class=\"hljs-attr\"\u003enode.id\u003c/span\u003e=ffffffff-ffff-ffff-ffff-ffffffffffff\n\u003cspan class=\"hljs-attr\"\u003enode.data-dir\u003c/span\u003e=~/presto/data\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCreate the file \u003ccode\u003e~/presto/etc/jvm.config\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e-server\n-Xmx16G\n-XX:+UseG1GC\n-XX:G1HeapRegionSize=32M\n-XX:+UseGCOverheadLimit\n-XX:+ExplicitGCInvokesConcurrent\n-XX:+HeapDumpOnOutOfMemoryError\n-XX:+ExitOnOutOfMemoryError\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCreate the file \u003ccode\u003e~/presto/etc/config.properties\u003c/code\u003e (replace the coordinator ip)\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs conf language-conf\"\u003e\u003cspan class=\"hljs-attr\"\u003ecoordinator\u003c/span\u003e=\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003ehttp-server.http.port\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e8081\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003ediscovery.uri\u003c/span\u003e=http://\u0026lt;coordinator ip\u0026gt;:\u003cspan class=\"hljs-number\"\u003e8081\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYou can also configure catalogs at this time.\u003c/p\u003e\n\u003cp\u003eNow give it a try by running Presto.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs sh language-sh\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e ~/presto/bin\n./launcher run\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf you get the service started message. you are ready to go ahead. you can stop Presto service now.\u003c/p\u003e\n\u003cp\u003eHere comes the interesting part. in the \u003ccode\u003enode.properties\u003c/code\u003e file, we have the value \u003ccode\u003effffffff-ffff-ffff-ffff-ffffffffffff\u003c/code\u003e. actually, this value should be a GUID.\u003c/p\u003e\n\u003cp\u003eSo what we are going to do is to auto-generate a GUID and replace this value when the system is starting. and run Presto as a service.\u003c/p\u003e\n\u003cp\u003eLet's create a script that will run at startup and start Presto service.\u003c/p\u003e\n\u003cp\u003ecreate the file \u003ccode\u003e~/runpresto.sh\u003c/code\u003e and put the content\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs sh language-sh\"\u003e\u003cspan class=\"hljs-meta\"\u003e#!/bin/sh -\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e# Replace the placeholder with a GUID\u003c/span\u003e\nsed -i \u003cspan class=\"hljs-string\"\u003e\u0026quot;s/ffffffff-ffff-ffff-ffff-ffffffffffff/\u003cspan class=\"hljs-subst\"\u003e$(uuidgen)\u003c/span\u003e/\u0026quot;\u003c/span\u003e /home/ubuntu/presto/etc/node.properties\n\u003cspan class=\"hljs-comment\"\u003e# Run presto\u003c/span\u003e\n/home/ubuntu/presto/bin/launcher run\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd make the file runnable.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs sh language-sh\"\u003e\u003cspan class=\"hljs-built_in\"\u003echmod\u003c/span\u003e u+x ~/runpresto.sh\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow we can run this script at startup. for that, we can use \u003ccode\u003esystemd\u003c/code\u003e.\nLet's create a service file for Presto.\u003c/p\u003e\n\u003cp\u003eCreate the file \u003ccode\u003e/etc/systemd/system/presto.service\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs conf language-conf\"\u003e\u003cspan class=\"hljs-attr\"\u003eDescription\u003c/span\u003e=Presto Worker\n\n\u003cspan class=\"hljs-section\"\u003e[Service]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eExecStart\u003c/span\u003e=/home/ubuntu/runpresto.sh\n\u003cspan class=\"hljs-attr\"\u003eRemainAfterExit\u003c/span\u003e=\u003cspan class=\"hljs-literal\"\u003eno\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eRestart\u003c/span\u003e=\u003cspan class=\"hljs-literal\"\u003eon\u003c/span\u003e-failure\n\u003cspan class=\"hljs-attr\"\u003eRestartSec\u003c/span\u003e=\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003es\n\n\u003cspan class=\"hljs-section\"\u003e[Install]\u003c/span\u003e\n\u003cspan class=\"hljs-attr\"\u003eWantedBy\u003c/span\u003e=multi-user.targer\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHere we say the service should re-start in 5 seconds if failed.\nNow we can register our service.\u003c/p\u003e\n\u003cp\u003erun \u003ccode\u003esudo systemctl daemon-reload\u003c/code\u003e and\n\u003ccode\u003esudo systemctl enable presto.service\u003c/code\u003e to make the script run at startup.\u003c/p\u003e\n\u003cp\u003eRestart the instance and Wait few seconds and run \u003ccode\u003esudo systemctl status presto.service\u003c/code\u003e to see if the service is running.\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Presto Service Running\" src=\"https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/presto-running.png\"\u003e\u003c/p\u003e\n\u003cp\u003eyou can also check the Presto dashboard to see if the worker is connected.\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Presto Service Running\" src=\"https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/one-worker.png\"\u003e\u003c/p\u003e\n\u003cp\u003eNow, stop the instance and create a machine image from it.\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Presto Service Running\" src=\"https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/worker-image.png\"\u003e\u003c/p\u003e\n\u003cp\u003eNow you can use this machine image to run as many workers you want.\u003c/p\u003e\n\u003cp\u003eHere, I have started 5 workers.\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Presto Service Running\" src=\"https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/5-workers-console.png\"\u003e\u003c/p\u003e\n\u003cp\u003eAnd all workers are connected and ready to use.\u003c/p\u003e\n\u003cp\u003e\u003cimg alt=\"Presto Service Running\" src=\"https://rusith.me/post-data/2019-07-25-re-usable-presto-worker/5-workers-dashboard.png\"\u003e\u003c/p\u003e"},"page":"Post","topTags":["programming","aws","web","machineLearning","react","javascript","dataScience","typescript","r","csharp"],"relatedPosts":[{"title":"Deploying an app on AWS ECS with CDK","tags":["programming","nextJS","react","aws","ecs","typescript","cdk","devops"],"fullUrl":"https://rusith.me/blog/deploy-app-on-aws-ecs-with-cdk-auto-scaling-and-load-balancing","date":"Wed, Feb 15, 2023","description":"How to deploy an application on AWS ECS with load-balancing and auto-scaling using CDK by writing the CDK code in TypeScript","banner":"/post-data/2023-02-15-deploying-react-app-on-ecs/banner.png"},{"title":"Running a Nuget Feed on S3 with Automated Deployments","tags":["programming","dotnet","s3","aws","nuget"],"fullUrl":"https://rusith.me/blog/nuget-feed-on-s3","date":"Sat, Nov 2, 2019","description":"There are many ways of creating a Nuget feed. but did you know that you can run a Nuget feed on S3 without any computing infrastructure? In this post, I will show you how you can create a Nuget feed on S3 using Sleet and automate the deployment process for packages.","banner":"/post-data/2019-11-03-nuget-feed-s3/banner.png"},{"title":"Deploying a Website on S3 With SSL, Continuous Integration","tags":["aws","programming","web"],"fullUrl":"https://rusith.me/blog/building-a-website-on-s3","date":"Mon, Aug 5, 2019","description":"In this post, I am creating a website and host it on S3 and setup a continuous integration pipeline setup using Gitlab","banner":"/post-data/2019-08-14-building-a-website-on-s3/banner.png"}]},"__N_SSG":true},"page":"/[[...path]]","query":{"path":["blog","re-usable-presto-worker-image-ec2"]},"buildId":"PaoTT2YDvwYY_jbobaNoC","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>