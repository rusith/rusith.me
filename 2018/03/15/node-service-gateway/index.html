<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link href="https://gmpg.org/xfn/11" rel="profile"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-5GDZWWBRFX"></script><script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){dataLayer.push(arguments);}
                gtag('js', new Date());
                gtag('config', 'G-5GDZWWBRFX');
                </script><link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://rusith.me/icons/favicon-144-image.png"/><link rel="shortcut icon" href="https://rusith.me/favicon.ico"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/><meta property="og:image" content="https://rusith.me/images/banner/default.jpg"/><meta property="twitter:creator" content="@rusith_"/><meta name="robots" content="index,follow"/><title>A Service Gateway Using NodeJS</title><meta name="description" content="In this post I am writing a simple and minimal service gateway using JavaScript and NodeJS which can handle authentication , authorization."/><link rel="canonical" href="https://rusith.me/blog/node-js-service-gateway"/><meta property="og:title" content="A Service Gateway Using NodeJS"/><meta property="og:url" content="https://rusith.me/blog/node-js-service-gateway"/><meta property="og:description" content="In this post I am writing a simple and minimal service gateway using JavaScript and NodeJS which can handle authentication , authorization."/><meta property="og:site_name" content="Rusith&#x27;s blog"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="blog"/><meta property="twitter:description" content="Creating a service gateway (API gateway) using JavaScript and NodeJS"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="A Service Gateway Using NodeJS"/><meta name="twitter:image" content="https://rusith.me/images/banner/default.jpg"/><meta name="twitter:site" content="@rusith_"/><script type="application/ld+json">{"@type":"BlogPosting","@context":"https://schema.org","headline":"A Service Gateway Using NodeJS","author":{"@type":"Person","name":"Shanaka Rusith","url":"https://rusith.me/about"},"keywords":"programming,javascript,micro-service,web","url":"https://rusith.me/blog/node-js-service-gateway","description":"In this post I am writing a simple and minimal service gateway using JavaScript and NodeJS which can handle authentication , authorization.","copyrightHolder":{"@type":"Person","name":"Shanaka Rusith","url":"https://rusith.me/about"},"copyrightYear":"2021","mainEntityOfPage":{"@type":"WebPage","@id":"https://rusith.me"},"publisher":{"@type":"Organization","name":"Shanaka Rusith","url":"https://rusith.me/about","logo":{"@type":"ImageObject","url":"https://rusith.me/images/rusith/picture.jpg"}},"image":"https://rusith.me/images/banner/default.jpg","about":"Creating a service gateway (API gateway) using JavaScript and NodeJS","datePublished":"Thu Mar 15 2018 00:00:00 GMT+0000 (Coordinated Universal Time)","dateModified":"Thu Mar 15 2018 00:00:00 GMT+0000 (Coordinated Universal Time)"}</script><meta name="next-head-count" content="27"/><link rel="preload" href="/_next/static/css/7220332d6168fb06.css" as="style"/><link rel="stylesheet" href="/_next/static/css/7220332d6168fb06.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0662676664ee362f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0662676664ee362f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-05c0aa1e498fcb8c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-f89480c30d9a5d02.js" defer=""></script><script src="/_next/static/chunks/947-277c090e7d6803d0.js" defer=""></script><script src="/_next/static/chunks/pages/%5B%5B...path%5D%5D-d5cf2aa81a49e144.js" defer=""></script><script src="/_next/static/PaoTT2YDvwYY_jbobaNoC/_buildManifest.js" defer=""></script><script src="/_next/static/PaoTT2YDvwYY_jbobaNoC/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="Sidebar_r__IEuUi"><div class="Sidebar_sticky__RE23V"><div class="Sidebar_about__s_kM6"><h2><a href="/">Rusith.me</a></h2><div class="Sidebar_socialButtons__XcH6p"><a href="https://www.linkedin.com/in/shanaka-rusith" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="LinkedIn icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MTYsMzJIMzEuOUMxNC4zLDMyLDAsNDYuNSwwLDY0LjN2MzgzLjRDMCw0NjUuNSwxNC4zLDQ4MCwzMS45LDQ4MEg0MTZjMTcuNiwwLDMyLTE0LjUsMzItMzIuM1Y2NC4zCglDNDQ4LDQ2LjUsNDMzLjYsMzIsNDE2LDMyeiBNMTM1LjQsNDE2SDY5VjIwMi4yaDY2LjVWNDE2SDEzNS40eiBNMTAyLjIsMTczYy0yMS4zLDAtMzguNS0xNy4zLTM4LjUtMzguNVM4MC45LDk2LDEwMi4yLDk2CgljMjEuMiwwLDM4LjUsMTcuMywzOC41LDM4LjVDMTQwLjcsMTU1LjgsMTIzLjUsMTczLDEwMi4yLDE3M3ogTTM4NC4zLDQxNmgtNjYuNFYzMTJjMC0yNC44LTAuNS01Ni43LTM0LjUtNTYuNwoJYy0zNC42LDAtMzkuOSwyNy0zOS45LDU0LjlWNDE2aC02Ni40VjIwMi4yaDYzLjd2MjkuMmgwLjljOC45LTE2LjgsMzAuNi0zNC41LDYyLjktMzQuNWM2Ny4yLDAsNzkuNyw0NC4zLDc5LjcsMTAxLjlWNDE2eiIvPgo8L3N2Zz4K"/></a><a href="https://github.com/rusith" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="Github icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MDAsMzJINDhDMjEuNSwzMiwwLDUzLjUsMCw4MHYzNTJjMCwyNi41LDIxLjUsNDgsNDgsNDhoMzUyYzI2LjUsMCw0OC0yMS41LDQ4LTQ4VjgwCglDNDQ4LDUzLjUsNDI2LjUsMzIsNDAwLDMyeiBNMjc3LjMsNDE1LjdjLTguNCwxLjUtMTEuNS0zLjctMTEuNS04YzAtNS40LDAuMi0zMywwLjItNTUuM2MwLTE1LjYtNS4yLTI1LjUtMTEuMy0zMC43CgljMzctNC4xLDc2LTkuMiw3Ni03My4xYzAtMTguMi02LjUtMjcuMy0xNy4xLTM5YzEuNy00LjMsNy40LTIyLTEuNy00NWMtMTMuOS00LjMtNDUuNywxNy45LTQ1LjcsMTcuOWMtMTMuMi0zLjctMjcuNS01LjYtNDEuNi01LjYKCXMtMjguNCwxLjktNDEuNiw1LjZjMCwwLTMxLjgtMjIuMi00NS43LTE3LjljLTkuMSwyMi45LTMuNSw0MC42LTEuNyw0NWMtMTAuNiwxMS43LTE1LjYsMjAuOC0xNS42LDM5YzAsNjMuNiwzNy4zLDY5LDc0LjMsNzMuMQoJYy00LjgsNC4zLTkuMSwxMS43LTEwLjYsMjIuM2MtOS41LDQuMy0zMy44LDExLjctNDguMy0xMy45Yy05LjEtMTUuOC0yNS41LTE3LjEtMjUuNS0xNy4xYy0xNi4yLTAuMi0xLjEsMTAuMi0xLjEsMTAuMgoJYzEwLjgsNSwxOC40LDI0LjIsMTguNCwyNC4yYzkuNywyOS43LDU2LjEsMTkuNyw1Ni4xLDE5LjdjMCwxMy45LDAuMiwzNi41LDAuMiw0MC42YzAsNC4zLTMsOS41LTExLjUsOAoJYy02Ni0yMi4xLTExMi4yLTg0LjktMTEyLjItMTU4LjNjMC05MS44LDcwLjItMTYxLjUsMTYyLTE2MS41UzM4OCwxNjUuNiwzODgsMjU3LjRDMzg4LjEsMzMwLjgsMzQzLjMsMzkzLjcsMjc3LjMsNDE1Ljd6CgkgTTE3OS4yLDM1NC42Yy0xLjksMC40LTMuNy0wLjQtMy45LTEuN2MtMC4yLTEuNSwxLjEtMi44LDMtMy4yYzEuOS0wLjIsMy43LDAuNiwzLjksMS45QzE4Mi41LDM1Mi45LDE4MS4yLDM1NC4yLDE3OS4yLDM1NC42CglMMTc5LjIsMzU0LjZ6IE0xNjkuNywzNTMuN2MwLDEuMy0xLjUsMi40LTMuNSwyLjRjLTIuMiwwLjItMy43LTAuOS0zLjctMi40YzAtMS4zLDEuNS0yLjQsMy41LTIuNAoJQzE2Ny45LDM1MS4xLDE2OS43LDM1Mi4yLDE2OS43LDM1My43eiBNMTU2LDM1Mi42Yy0wLjQsMS4zLTIuNCwxLjktNC4xLDEuM2MtMS45LTAuNC0zLjItMS45LTIuOC0zLjJjMC40LTEuMywyLjQtMS45LDQuMS0xLjUKCUMxNTUuMiwzNDkuOCwxNTYuNSwzNTEuMywxNTYsMzUyLjZMMTU2LDM1Mi42eiBNMTQzLjcsMzQ3LjJjLTAuOSwxLjEtMi44LDAuOS00LjMtMC42Yy0xLjUtMS4zLTEuOS0zLjItMC45LTQuMQoJYzAuOS0xLjEsMi44LTAuOSw0LjMsMC42QzE0NC4xLDM0NC40LDE0NC42LDM0Ni40LDE0My43LDM0Ny4yeiBNMTM0LjYsMzM4LjFjLTAuOSwwLjYtMi42LDAtMy43LTEuNXMtMS4xLTMuMiwwLTMuOQoJYzEuMS0wLjksMi44LTAuMiwzLjcsMS4zQzEzNS43LDMzNS41LDEzNS43LDMzNy4zLDEzNC42LDMzOC4xeiBNMTI4LjEsMzI4LjRjLTAuOSwwLjktMi40LDAuNC0zLjUtMC42Yy0xLjEtMS4zLTEuMy0yLjgtMC40LTMuNQoJYzAuOS0wLjksMi40LTAuNCwzLjUsMC42QzEyOC44LDMyNi4yLDEyOSwzMjcuNywxMjguMSwzMjguNHogTTEyMS40LDMyMWMtMC40LDAuOS0xLjcsMS4xLTIuOCwwLjRjLTEuMy0wLjYtMS45LTEuNy0xLjUtMi42CgljMC40LTAuNiwxLjUtMC45LDIuOC0wLjRDMTIxLjIsMzE5LjEsMTIxLjgsMzIwLjIsMTIxLjQsMzIxeiIvPgo8L3N2Zz4K"/></a><a href="https://gitlab.com/rusith" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="Gitlab icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUuMiwyNC45Yy0zLjEtOC45LTE1LjctOC45LTE4LjksMEwyOS44LDE5OS43aDEzMkMxNjEuNywxOTkuNywxMDUuMiwyNC45LDEwNS4yLDI0Ljl6IE0wLjksMjg3LjcKCWMtMi42LDgsMC4zLDE2LjksNy4xLDIybDI0Ny45LDE4NGwtMjI2LjItMjk0TDAuOSwyODcuN3ogTTE2MS43LDE5OS43bDk0LjMsMjk0bDk0LjMtMjk0SDE2MS43eiBNNTExLjEsMjg3LjdsLTI4LjgtODhMMjU2LDQ5My43CglsMjQ3LjktMTg0QzUxMC44LDMwNC42LDUxMy42LDI5NS43LDUxMS4xLDI4Ny43eiBNNDI1LjcsMjQuOWMtMy4xLTguOS0xNS43LTguOS0xOC45LDBsLTU2LjYsMTc0LjhoMTMyTDQyNS43LDI0Ljl6Ii8+Cjwvc3ZnPgo="/></a><a href="http://goodreads.com/rusith" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="GoodReads icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0yOTkuOSwxOTEuMmM1LjEsMzcuMy00LjcsNzktMzUuOSwxMDAuN2MtMjIuMywxNS41LTUyLjgsMTQuMS03MC44LDUuN2MtMzcuMS0xNy4zLTQ5LjUtNTguNi00Ni44LTk3LjIKCWM0LjMtNjAuOSw0MC45LTg3LjksNzUuMy04Ny41QzI2OC42LDExMi43LDI5My41LDE0NC43LDI5OS45LDE5MS4yTDI5OS45LDE5MS4yeiBNNDQ4LDg4djMzNmMwLDMwLjktMjUuMSw1Ni01Niw1Nkg1NgoJYy0zMC45LDAtNTYtMjUuMS01Ni01NlY4OGMwLTMwLjksMjUuMS01Niw1Ni01NmgzMzZDNDIyLjksMzIsNDQ4LDU3LjEsNDQ4LDg4eiBNMzMwLDMxMy4yYzAsMC0wLjEtMzQtMC4xLTIxNy4zaC0yOXY0MC4zCgljLTAuOCwwLjMtMS4yLTAuNS0xLjYtMS4yYy05LjYtMjAuNy0zNS45LTQ2LjMtNzYtNDZjLTUxLjksMC40LTg3LjIsMzEuMi0xMDAuNiw3Ny44Yy00LjMsMTQuOS01LjgsMzAuMS01LjUsNDUuNgoJYzEuNyw3Ny45LDQ1LjEsMTE3LjgsMTEyLjQsMTE1LjJjMjguOS0xLjEsNTQuNS0xNyw2OS00NS4yYzAuNS0xLDEuMS0xLjksMS43LTIuOWMwLjIsMC4xLDAuNCwwLjEsMC42LDAuMgoJYzAuMywzLjgsMC4yLDMwLjcsMC4xLDM0LjVjLTAuMiwxNC44LTIsMjkuNS03LjIsNDMuNWMtNy44LDIxLTIyLjMsMzQuNy00NC41LDM5LjVjLTE3LjgsMy45LTM1LjYsMy44LTUzLjItMS4yCgljLTIxLjUtNi4xLTM2LjUtMTktNDEuMS00MS44Yy0wLjMtMS42LTEuMy0xLjMtMi4zLTEuM2gtMjYuOGMwLjgsMTAuNiwzLjIsMjAuMyw4LjUsMjkuMmMyNC4yLDQwLjUsODIuNyw0OC41LDEyOC4yLDM3LjQKCUMzMTIuNSw0MDcuMiwzMjkuOSwzNjQuNiwzMzAsMzEzLjJMMzMwLDMxMy4yeiIvPgo8L3N2Zz4K"/></a><a href="https://twitter.com/rusith_" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="Twitter icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MDAsMzJINDhDMjEuNSwzMiwwLDUzLjUsMCw4MHYzNTJjMCwyNi41LDIxLjUsNDgsNDgsNDhoMzUyYzI2LjUsMCw0OC0yMS41LDQ4LTQ4VjgwCglDNDQ4LDUzLjUsNDI2LjUsMzIsNDAwLDMyeiBNMzUxLjEsMTkwLjhjMC4yLDIuOCwwLjIsNS43LDAuMiw4LjVjMCw4Ni43LTY2LDE4Ni42LTE4Ni42LDE4Ni42Yy0zNy4yLDAtNzEuNy0xMC44LTEwMC43LTI5LjQKCWM1LjMsMC42LDEwLjQsMC44LDE1LjgsMC44YzMwLjcsMCw1OC45LTEwLjQsODEuNC0yOGMtMjguOC0wLjYtNTMtMTkuNS02MS4zLTQ1LjVjMTAuMSwxLjUsMTkuMiwxLjUsMjkuNi0xLjIKCWMtMzAtNi4xLTUyLjUtMzIuNS01Mi41LTY0LjR2LTAuOGM4LjcsNC45LDE4LjksNy45LDI5LjYsOC4zYy0xOC4zLTEyLjItMjkuMi0zMi43LTI5LjItNTQuNmMwLTEyLjIsMy4yLTIzLjQsOC45LTMzLjEKCWMzMi4zLDM5LjgsODAuOCw2NS44LDEzNS4yLDY4LjZjLTkuMy00NC41LDI0LTgwLjYsNjQtODAuNmMxOC45LDAsMzUuOSw3LjksNDcuOSwyMC43YzE0LjgtMi44LDI5LTguMyw0MS42LTE1LjgKCWMtNC45LDE1LjItMTUuMiwyOC0yOC44LDM2LjFjMTMuMi0xLjQsMjYtNS4xLDM3LjgtMTAuMkMzNzUuMSwxNjkuOSwzNjMuOSwxODEuNSwzNTEuMSwxOTAuOHoiLz4KPC9zdmc+Cg=="/></a><a href="https://www.facebook.com/shanaka.rusith" class="Sidebar_socialButton___U_F2" target="_blank" rel="noreferrer"><img alt="Facebook icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MDAsMzJINDhDMjEuNSwzMiwwLDUzLjUsMCw4MHYzNTJjMCwyNi41LDIxLjUsNDgsNDgsNDhoMTM3LjNWMzI3LjdoLTYzVjI1Nmg2M3YtNTQuNgoJYzAtNjIuMiwzNy05Ni41LDkzLjctOTYuNWMyNy4xLDAsNTUuNSw0LjgsNTUuNSw0Ljh2NjFoLTMxLjNjLTMwLjgsMC00MC40LDE5LjEtNDAuNCwzOC43VjI1Nmg2OC44bC0xMSw3MS43aC01Ny44VjQ4MEg0MDAKCWMyNi41LDAsNDgtMjEuNSw0OC00OFY4MEM0NDgsNTMuNSw0MjYuNSwzMiw0MDAsMzJ6Ii8+Cjwvc3ZnPgo="/></a></div><p>A blog from a tech and art enthusiast</p></div><div class="Sidebar_nav__CTYKS"><div class="Sidebar_tagWrapper__w460D"><a href="/tag/programming/"><span class="Sidebar_tag__mAo8y">#<!-- -->programming</span></a><a href="/tag/aws/"><span class="Sidebar_tag__mAo8y">#<!-- -->aws</span></a><a href="/tag/web/"><span class="Sidebar_tag__mAo8y">#<!-- -->web</span></a><a href="/tag/machineLearning/"><span class="Sidebar_tag__mAo8y">#<!-- -->machineLearning</span></a><a href="/tag/react/"><span class="Sidebar_tag__mAo8y">#<!-- -->react</span></a><a href="/tag/javascript/"><span class="Sidebar_tag__mAo8y">#<!-- -->javascript</span></a><a href="/tag/dataScience/"><span class="Sidebar_tag__mAo8y">#<!-- -->dataScience</span></a><a href="/tag/typescript/"><span class="Sidebar_tag__mAo8y">#<!-- -->typescript</span></a><a href="/tag/r/"><span class="Sidebar_tag__mAo8y">#<!-- -->r</span></a><a href="/tag/csharp/"><span class="Sidebar_tag__mAo8y">#<!-- -->csharp</span></a></div></div></div></div><div class="comp_content__73ns2"><div><h1>A Service Gateway Using NodeJS</h1><div class="Post_tags__HKWUb"><a class="Post_tag__5GXoX" href="https://rusith.me/tag/programming">#<!-- -->programming</a><a class="Post_tag__5GXoX" href="https://rusith.me/tag/javascript">#<!-- -->javascript</a><a class="Post_tag__5GXoX" href="https://rusith.me/tag/micro-service">#<!-- -->micro-service</a><a class="Post_tag__5GXoX" href="https://rusith.me/tag/web">#<!-- -->web</a></div><span class="Post_date__h8Of6">Thu, Mar 15, 2018</span><div><p>This is an API gateway implemented using <a href="https://www.npmjs.com/package/httpp-proxy">Node JS Proxy</a> and <a href="https://www.npmjs.com/package/redis">Redis</a>.</p>
<p>The use case was I Had to implement a service gateway for a microservice backend. I tried various open source API gateways but didn’t help with my requirements. some of my requirements was</p>
<ul>
<li>Some endpoints or APIs are secured while others aren’t</li>
<li>One token can be used to access all secured endpoints</li>
<li>Users should be authenticated using username and password</li>
</ul>
<p>Then i decided to do it my self without using an existing implementation. as a temporary solution. Here I Use Node JS to write the proxy . Node JS does a great job handling requests.</p>
<pre><code class="hljs js language-js">(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-string">&quot;use strict&quot;</span>;

    <span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>),
        httpProxy = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http-proxy&#x27;</span>);
    <span class="hljs-keyword">var</span> redis = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;redis&#x27;</span>); <span class="hljs-comment">// We use redis to store tokens.</span>
    <span class="hljs-keyword">var</span> redisClient = redis.<span class="hljs-title function_">createClient</span>(<span class="hljs-number">6379</span>, <span class="hljs-string">&#x27;localhost&#x27;</span>); <span class="hljs-comment">// Create the redis client.</span>
    <span class="hljs-keyword">var</span> helpers = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./base/helpers.js&quot;</span>); <span class="hljs-comment">// This module contains some helper functions.</span>
    <span class="hljs-keyword">var</span> <span class="hljs-title class_">TokenEndPoint</span> = <span class="hljs-string">&#x27;/token&#x27;</span>; <span class="hljs-comment">// Endpoint of the token requests.</span>
    <span class="hljs-keyword">var</span> settings = { <span class="hljs-comment">// Settings used in the proxy  (can be from a file or database).</span>
      <span class="hljs-string">&quot;userAuthenticationPath&quot;</span>: <span class="hljs-string">&quot;/users/authenticate&quot;</span>, <span class="hljs-comment">// The endpoint in the authentication API  which actually authenticates the user.</span>
      <span class="hljs-string">&quot;authenticationServiceUrl&quot;</span>: <span class="hljs-string">&quot;http://authservice&quot;</span>, <span class="hljs-comment">// Hostname of the authentication service (API). </span>
      <span class="hljs-string">&quot;tokenLifeTime&quot;</span>: <span class="hljs-number">3600</span>, <span class="hljs-comment">// Lifetime of an access token.</span>
      <span class="hljs-string">&quot;origins&quot;</span>: [<span class="hljs-string">&quot;http://abc.com&quot;</span>], <span class="hljs-comment">// Allowed origins.</span>
      <span class="hljs-string">&quot;listen&quot;</span>: <span class="hljs-number">5500</span>, <span class="hljs-comment">// Port to listen.</span>
      <span class="hljs-string">&quot;services&quot;</span>: [{  <span class="hljs-comment">// List of services (APIs).</span>
              <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Order Service&quot;</span>, <span class="hljs-comment">// Name of the service.</span>
              <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;/orders&quot;</span>, <span class="hljs-comment">// Paths belong to this service. </span>
              <span class="hljs-string">&quot;authenticate&quot;</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Only authorized users can access this API.</span>
              <span class="hljs-string">&quot;allowedMethods&quot;</span>: <span class="hljs-string">&quot;GET,POST,PUT,DELETE&quot;</span>, <span class="hljs-comment">// Allowed HTTP verbs.</span>
              <span class="hljs-string">&quot;upStream&quot;</span>: <span class="hljs-string">&quot;http://orderservice&quot;</span> <span class="hljs-comment">// Destination address of the API.</span>
          },
          {
              <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Item Service&quot;</span>,
              <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;/items&quot;</span>,
              <span class="hljs-string">&quot;authenticate&quot;</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// Anyone can access this API.</span>
              <span class="hljs-string">&quot;allowedMethods&quot;</span>: <span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-comment">// Only GET is allowed.</span>
              <span class="hljs-string">&quot;upStream&quot;</span>: <span class="hljs-string">&quot;http://itemservice&quot;</span>
          }
      ]
    };

    <span class="hljs-comment">// This function gives the service for given base path.</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getServiceForPath</span>(<span class="hljs-params">path</span>) {
        <span class="hljs-keyword">var</span> services = settings.<span class="hljs-property">services</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, sl = services.<span class="hljs-property">length</span>; i &lt; sl; i++) {
            <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">startsWith</span>(services[i].<span class="hljs-property">path</span>)) {
                <span class="hljs-keyword">return</span> services[i];
            }
        }
    }

    <span class="hljs-comment">// Creates the proxy server.</span>
    <span class="hljs-keyword">var</span> proxy = httpProxy.<span class="hljs-title function_">createProxyServer</span>({});

    <span class="hljs-comment">// Registers a function to call when a response is arrived.</span>
    proxy.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;proxyRes&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">proxyReq, req, res, options</span>) {
        <span class="hljs-comment">// If the request is a token request (we set this property in the request code), we execute below code.</span>
        <span class="hljs-comment">// Otherwise the response will be delivered to the requester as is.</span>
        <span class="hljs-keyword">if</span> (req.<span class="hljs-property">tokenRequest</span> &amp;&amp; proxyReq.<span class="hljs-property">statusCode</span> === <span class="hljs-number">200</span>) {
            <span class="hljs-keyword">var</span> userId = proxyReq.<span class="hljs-property">headers</span>.<span class="hljs-property">userid</span>;
            <span class="hljs-comment">// Authentication API should set the userid header if the credentials are correct.</span>
            <span class="hljs-comment">// If the header userid is not exists, we send a not authorized response the the requester. </span>
            <span class="hljs-keyword">if</span> (!userId) {
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">sendNotAuthorized</span>(res);
            }
            <span class="hljs-comment">// Creates a GUID as an access token.</span>
            <span class="hljs-keyword">var</span> accessToken = helpers.<span class="hljs-title function_">guid</span>();
            <span class="hljs-comment">// Save the access token in Redis.</span>
            redisClient.<span class="hljs-title function_">setex</span>(accessToken, settings.<span class="hljs-property">tokenLifeTime</span>, <span class="hljs-string">&#x27;1&#x27;</span>);
            <span class="hljs-comment">// Set headers required by the requester.</span>
            res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;token&#x27;</span>, accessToken);
            res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;expires_in&#x27;</span>, settings.<span class="hljs-property">tokenLifeTime</span>);
            res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Access-Control-Expose-Headers&#x27;</span>, <span class="hljs-string">&#x27;token,expires_in,userid&#x27;</span>);
        }
    });

    <span class="hljs-comment">// proxy the request to the target service.</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendToService</span>(<span class="hljs-params">service, req, res</span>) {
        <span class="hljs-keyword">var</span> url = req.<span class="hljs-property">url</span>;
        req.<span class="hljs-property">url</span> = url.<span class="hljs-title function_">substr</span>(service.<span class="hljs-property">path</span>.<span class="hljs-property">length</span>, url.<span class="hljs-property">length</span> - service.<span class="hljs-property">path</span>.<span class="hljs-property">length</span>);
        proxy.<span class="hljs-title function_">web</span>(req, res, { <span class="hljs-attr">target</span>: service.<span class="hljs-property">upStream</span> }, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e); });
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendJson</span>(<span class="hljs-params">obj, res</span>) {
        res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>);
        res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendNotAuthorized</span>(<span class="hljs-params">res</span>) {
        res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">401</span>;
        <span class="hljs-title function_">sendJson</span>(<span class="hljs-string">&#x27;You are not allowed to access this API!&#x27;</span>, res);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendNotFound</span>(<span class="hljs-params">res</span>) {
        res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">404</span>;
        <span class="hljs-title function_">sendJson</span>(<span class="hljs-string">&#x27;Could not find any resources for given path.&#x27;</span>, res);
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMethodNotAllowed</span>(<span class="hljs-params">res</span>) {
        res.<span class="hljs-property">statusCode</span> = <span class="hljs-number">405</span>;
        <span class="hljs-title function_">sendJson</span>(<span class="hljs-string">&#x27;Method not allowed&#x27;</span>, res);
    }

    <span class="hljs-comment">// Check CORS of the request</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">CheckCors</span>(<span class="hljs-params">service, req, res</span>) {
        <span class="hljs-comment">// Set needed headers.</span>
        <span class="hljs-keyword">if</span> (req.<span class="hljs-property">headers</span>.<span class="hljs-property">origin</span>) {
            res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>, req.<span class="hljs-property">headers</span>.<span class="hljs-property">origin</span>);
        }
        res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Methods&#x27;</span>, service.<span class="hljs-property">allowedMethods</span>);
        res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="hljs-string">&#x27;Authorization,Content-Type,Accept&#x27;</span>);
        <span class="hljs-comment">// Just send the response if the request is an POTIONS request.</span>
        <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> == <span class="hljs-string">&#x27;OPTIONS&#x27;</span>) {
            res.<span class="hljs-title function_">end</span>();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">var</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) {
        <span class="hljs-keyword">var</span> origins = settings.<span class="hljs-property">origins</span>;
        <span class="hljs-keyword">var</span> requestHeaders = req.<span class="hljs-property">headers</span>;
        <span class="hljs-keyword">var</span> requestUrl = req.<span class="hljs-property">url</span>.<span class="hljs-title function_">toLowerCase</span>();
        <span class="hljs-comment">// If the allowed origins are declared in the settings.</span>
        <span class="hljs-keyword">if</span> (origins) {
            <span class="hljs-comment">// Check the origin of the request and send a not authorized response if the request origin is not allowed.</span>
            <span class="hljs-keyword">if</span> (!requestHeaders.<span class="hljs-property">origin</span> || <span class="hljs-number">0</span> &gt; origins.<span class="hljs-title function_">indexOf</span>(requestHeaders.<span class="hljs-property">origin</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">sendNotAuthorized</span>(res);
            }
        }
        <span class="hljs-comment">// If the request is for getting the token.</span>
        <span class="hljs-keyword">if</span> (requestUrl.<span class="hljs-title function_">startsWith</span>(<span class="hljs-title class_">TokenEndPoint</span>)) {
            <span class="hljs-comment">// Set request property to check later in the response code.</span>
            req.<span class="hljs-property">tokenRequest</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-comment">// Change destination to the authentication endpoint in the authentication API.</span>
            req.<span class="hljs-property">url</span> = settings.<span class="hljs-property">userAuthenticationPath</span>;
            <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">CheckCors</span>({ <span class="hljs-attr">allowedMethods</span>: <span class="hljs-string">&#x27;POST&#x27;</span> }, req, res)) {
                <span class="hljs-comment">// Proxy the request.</span>
                proxy.<span class="hljs-title function_">web</span>(req, res, { <span class="hljs-attr">target</span>: settings.<span class="hljs-property">authenticationServiceUrl</span> }, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e); });
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// Get the service.</span>
            <span class="hljs-keyword">var</span> service = <span class="hljs-title function_">getServiceForPath</span>(requestUrl);
            <span class="hljs-keyword">if</span> (!service) {
                <span class="hljs-comment">// If no service found for the request path, returns a not found.</span>
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">sendNotFound</span>(res);
            }
            <span class="hljs-comment">// If the method is not OPTIONS and method is not in the allowed methods list ,</span>
            <span class="hljs-comment">// returns a not allowed response.</span>
            <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> != <span class="hljs-string">&#x27;OPTIONS&#x27;</span> &amp;&amp; -<span class="hljs-number">1</span> &gt; service.<span class="hljs-property">allowedMethods</span>.<span class="hljs-title function_">indexOf</span>(req.<span class="hljs-property">method</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-title function_">sendMethodNotAllowed</span>(res);
            }
            <span class="hljs-comment">// If the service needs authentication.</span>
            <span class="hljs-keyword">if</span> (service.<span class="hljs-property">authenticate</span>) {
                <span class="hljs-comment">// Request must have the the authorization header.</span>
                <span class="hljs-keyword">if</span> (requestHeaders.<span class="hljs-property">authorization</span>) {
                   <span class="hljs-comment">// If Redis has a value for request&#x27;s authentication header value.</span>
                    redisClient.<span class="hljs-title function_">exists</span>(requestHeaders.<span class="hljs-property">authorization</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">err, reply</span>) {
                        <span class="hljs-keyword">if</span> (reply === <span class="hljs-number">1</span>) {
                            <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">CheckCors</span>(service, req, res)) {
                                <span class="hljs-comment">// Proxy the request to the target service.</span>
                                <span class="hljs-keyword">return</span> <span class="hljs-title function_">sendToService</span>(service, req, res);
                            }
                        } <span class="hljs-keyword">else</span> {
                            <span class="hljs-comment">// If not authenticated or token has expired , send a not authorized response.</span>
                            <span class="hljs-keyword">return</span> <span class="hljs-title function_">sendNotAuthorized</span>(res);
                        }
                    });
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// If authorization header does not exist , then send a not authorized response.</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-title function_">sendNotAuthorized</span>(res);
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// If the service does not need authentication , proxy the request to the target service.</span>
                <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">CheckCors</span>(service, req, res)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-title function_">sendToService</span>(service, req, res);
                }
            }
        }
    });
    <span class="hljs-comment">// Listen to the port.</span>
    server.<span class="hljs-title function_">listen</span>(settings.<span class="hljs-property">listen</span>);
})();
</code></pre></div></div><div class="Post_related__V0k3K"><h2>Related Posts</h2><ul class="Post_relatedPosts__co9O7"><li><h3><a href="https://rusith.me/blog/react-form-validation-using-custom-hooks">React Form Validation Using Custom Hooks<small>Mon, Jun 24, 2019</small></a></h3></li><li><h3><a href="https://rusith.me/blog/testing-react-redux-connected-components-using-jest">Testing Redux Connected React Components Using Jest<small>Mon, Apr 27, 2020</small></a></h3></li><li><h3><a href="https://rusith.me/blog/building-a-website-on-s3">Deploying a Website on S3 With SSL, Continuous Integration<small>Mon, Aug 5, 2019</small></a></h3></li></ul></div><div id="disqus_thread"></div></div><div class="sbuttons"><a href="https://www.facebook.com/sharer/sharer.php?u=https://rusith.me/blog/node-js-service-gateway" target="_blank" class="sbutton fb" title="Share on Facebook" rel="noreferrer"><img alt="Facebook icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAzMjAgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAzMjAgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0yNzkuMSwyODhsMTQuMi05Mi43aC04OC45di02MC4xYzAtMjUuMywxMi40LTUwLjEsNTIuMi01MC4xaDQwLjRWNi4zYzAsMC0zNi43LTYuMy03MS43LTYuMwoJYy03My4yLDAtMTIxLjEsNDQuNC0xMjEuMSwxMjQuN3Y3MC42SDIyLjlWMjg4aDgxLjR2MjI0aDEwMC4yVjI4OEgyNzkuMXoiLz4KPC9zdmc+Cg=="/></a><a href="https://twitter.com/intent/tweet?text=https://rusith.me/blog/node-js-service-gateway" target="_blank" class="sbutton twitt" title="Share on Twitter" rel="noreferrer"><img alt="Twitter icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00NTkuNCwxNTEuN2MwLjMsNC41LDAuMyw5LjEsMC4zLDEzLjZjMCwxMzguNy0xMDUuNiwyOTguNi0yOTguNiwyOTguNmMtNTkuNSwwLTExNC43LTE3LjItMTYxLjEtNDcuMQoJYzguNCwxLDE2LjYsMS4zLDI1LjMsMS4zYzQ5LjEsMCw5NC4yLTE2LjYsMTMwLjMtNDQuOGMtNDYuMS0xLTg0LjgtMzEuMi05OC4xLTcyLjhjNi41LDEsMTMsMS42LDE5LjgsMS42YzkuNCwwLDE4LjgtMS4zLDI3LjYtMy42CgljLTQ4LjEtOS43LTg0LjEtNTItODQuMS0xMDN2LTEuM2MxNCw3LjgsMzAuMiwxMi43LDQ3LjQsMTMuM2MtMjguMy0xOC44LTQ2LjgtNTEtNDYuOC04Ny40YzAtMTkuNSw1LjItMzcuNCwxNC4zLTUzCglDODcuNCwxMzAuOSwxNjUsMTcyLjUsMjUyLjEsMTc3LjFjLTEuNi03LjgtMi42LTE1LjktMi42LTI0YzAtNTcuOCw0Ni44LTEwNC45LDEwNC45LTEwNC45YzMwLjIsMCw1Ny41LDEyLjcsNzYuNywzMy4xCgljMjMuNy00LjUsNDYuNS0xMy4zLDY2LjYtMjUuM2MtNy44LDI0LjQtMjQuNCw0NC44LTQ2LjEsNTcuOGMyMS4xLTIuMyw0MS42LTguMSw2MC40LTE2LjJDNDk3LjcsMTE4LjMsNDc5LjgsMTM2LjgsNDU5LjQsMTUxLjcKCUw0NTkuNCwxNTEuN3oiLz4KPC9zdmc+Cg=="/></a><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://rusith.me/blog/node-js-service-gateway&amp;title=&amp;summary=&amp;source=" target="_blank" class="sbutton linkedin" title="Share on Linkedin" rel="noreferrer"><img alt="LinkedIn icon" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDAuMyw0NDhINy40VjE0OC45aDkyLjlWNDQ4eiBNNTMuOCwxMDguMUMyNC4xLDEwOC4xLDAsODMuNSwwLDUzLjhDMCwyNC4xLDI0LjEsMCw1My44LDAKCWMyOS43LDAsNTMuOCwyNC4xLDUzLjgsNTMuOEMxMDcuNiw4My41LDgzLjUsMTA4LjEsNTMuOCwxMDguMXogTTQ0Ny45LDQ0OGgtOTIuN1YzMDIuNGMwLTM0LjctMC43LTc5LjItNDguMy03OS4yCgljLTQ4LjMsMC01NS43LDM3LjctNTUuNyw3Ni43VjQ0OGgtOTIuOFYxNDguOWg4OS4xdjQwLjhoMS4zYzEyLjQtMjMuNSw0Mi43LTQ4LjMsODcuOS00OC4zYzk0LDAsMTExLjMsNjEuOSwxMTEuMywxNDIuM1Y0NDhINDQ3Ljl6CgkiLz4KPC9zdmc+Cg=="/></a><a target="_blank" class="sbutton mainsbutton"><img alt="Share button" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIzLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0NDggNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NDggNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0zNTIsMzIwYy0yNS42LDAtNDguOSwxMC02Ni4xLDI2LjRsLTk4LjMtNjEuNWM1LjktMTguOCw1LjktMzkuMSwwLTU3LjhsOTguMy02MS41CglDMzAzLjEsMTgyLDMyNi40LDE5MiwzNTIsMTkyYzUzLDAsOTYtNDMsOTYtOTZTNDA1LDAsMzUyLDBzLTk2LDQzLTk2LDk2YzAsOS44LDEuNSwxOS42LDQuNCwyOC45bC05OC4zLDYxLjUKCUMxNDQuOSwxNzAsMTIxLjYsMTYwLDk2LDE2MGMtNTMsMC05Niw0My05Niw5NnM0Myw5Niw5Niw5NmMyNS42LDAsNDguOS0xMCw2Ni4xLTI2LjRsOTguMyw2MS41Yy0yLjksOS40LTQuNCwxOS4xLTQuNCwyOC45CgljMCw1Myw0Myw5Niw5Niw5NnM5Ni00Myw5Ni05NlM0MDUsMzIwLDM1MiwzMjBMMzUyLDMyMHogTTM1Miw0OGMyNi41LDAsNDgsMjEuNSw0OCw0OHMtMjEuNSw0OC00OCw0OHMtNDgtMjEuNS00OC00OAoJUzMyNS41LDQ4LDM1Miw0OHogTTk2LDMwNGMtMjYuNSwwLTQ4LTIxLjUtNDgtNDhzMjEuNS00OCw0OC00OHM0OCwyMS41LDQ4LDQ4UzEyMi41LDMwNCw5NiwzMDR6IE0zNTIsNDY0Yy0yNi41LDAtNDgtMjEuNS00OC00OAoJczIxLjUtNDgsNDgtNDhzNDgsMjEuNSw0OCw0OFMzNzguNSw0NjQsMzUyLDQ2NHoiLz4KPC9zdmc+Cg=="/></a></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"fileName":"2018-03-15-node-service-gateway.md","fullPath":"/home/runner/work/rusith.me/rusith.me/modules/blog/posts/2018-03-15-node-service-gateway.md","layout":"post","title":"A Service Gateway Using NodeJS","tags":["programming","javascript","micro-service","web"],"comments":true,"description":"In this post I am writing a simple and minimal service gateway using JavaScript and NodeJS which can handle authentication , authorization.","dateCreated":"Thu Mar 15 2018 00:00:00 GMT+0000 (Coordinated Universal Time)","dateModified":"Thu Mar 15 2018 00:00:00 GMT+0000 (Coordinated Universal Time)","datePublished":"Thu Mar 15 2018 00:00:00 GMT+0000 (Coordinated Universal Time)","dependencies":"NodeJS","about":"Creating a service gateway (API gateway) using JavaScript and NodeJS","path":"/blog/node-js-service-gateway","oldPath":"/2018/03/15/node-service-gateway","dateCreatedFormatted":"Thu, Mar 15, 2018","fullUrl":"https://rusith.me/blog/node-js-service-gateway","fileContent":"---\nlayout: post\ntitle: A Service Gateway Using NodeJS\ntags: programming javascript micro-service web\ncomments: true\ndescription: In this post I am writing a simple and minimal service gateway using JavaScript and NodeJS which can handle authentication , authorization.\ndateCreated: 2018-03-15\ndateModified: 2018-03-15\ndatePublished: 2018-03-15\ndependencies: NodeJS\nabout: Creating a service gateway (API gateway) using JavaScript and NodeJS\npath: /node-js-service-gateway\noldPath: /2018/03/15/node-service-gateway\n---\n\nThis is an API gateway implemented using [Node JS Proxy](https://www.npmjs.com/package/httpp-proxy) and [Redis](https://www.npmjs.com/package/redis).\n\nThe use case was I Had to implement a service gateway for a microservice backend. I tried various open source API gateways but didn’t help with my requirements. some of my requirements was\n\n* Some endpoints or APIs are secured while others aren’t\n* One token can be used to access all secured endpoints\n* Users should be authenticated using username and password\n\nThen i decided to do it my self without using an existing implementation. as a temporary solution. Here I Use Node JS to write the proxy . Node JS does a great job handling requests.\n\n```js\n(function() {\n    \"use strict\";\n\n    var http = require('http'),\n        httpProxy = require('http-proxy');\n    var redis = require('redis'); // We use redis to store tokens.\n    var redisClient = redis.createClient(6379, 'localhost'); // Create the redis client.\n    var helpers = require(\"./base/helpers.js\"); // This module contains some helper functions.\n    var TokenEndPoint = '/token'; // Endpoint of the token requests.\n    var settings = { // Settings used in the proxy  (can be from a file or database).\n      \"userAuthenticationPath\": \"/users/authenticate\", // The endpoint in the authentication API  which actually authenticates the user.\n      \"authenticationServiceUrl\": \"http://authservice\", // Hostname of the authentication service (API). \n      \"tokenLifeTime\": 3600, // Lifetime of an access token.\n      \"origins\": [\"http://abc.com\"], // Allowed origins.\n      \"listen\": 5500, // Port to listen.\n      \"services\": [{  // List of services (APIs).\n              \"name\": \"Order Service\", // Name of the service.\n              \"path\": \"/orders\", // Paths belong to this service. \n              \"authenticate\": true, // Only authorized users can access this API.\n              \"allowedMethods\": \"GET,POST,PUT,DELETE\", // Allowed HTTP verbs.\n              \"upStream\": \"http://orderservice\" // Destination address of the API.\n          },\n          {\n              \"name\": \"Item Service\",\n              \"path\": \"/items\",\n              \"authenticate\": false, // Anyone can access this API.\n              \"allowedMethods\": \"GET\", // Only GET is allowed.\n              \"upStream\": \"http://itemservice\"\n          }\n      ]\n    };\n\n    // This function gives the service for given base path.\n    function getServiceForPath(path) {\n        var services = settings.services;\n        for (var i = 0, sl = services.length; i \u003c sl; i++) {\n            if (path.startsWith(services[i].path)) {\n                return services[i];\n            }\n        }\n    }\n\n    // Creates the proxy server.\n    var proxy = httpProxy.createProxyServer({});\n\n    // Registers a function to call when a response is arrived.\n    proxy.on('proxyRes', function(proxyReq, req, res, options) {\n        // If the request is a token request (we set this property in the request code), we execute below code.\n        // Otherwise the response will be delivered to the requester as is.\n        if (req.tokenRequest \u0026\u0026 proxyReq.statusCode === 200) {\n            var userId = proxyReq.headers.userid;\n            // Authentication API should set the userid header if the credentials are correct.\n            // If the header userid is not exists, we send a not authorized response the the requester. \n            if (!userId) {\n                return sendNotAuthorized(res);\n            }\n            // Creates a GUID as an access token.\n            var accessToken = helpers.guid();\n            // Save the access token in Redis.\n            redisClient.setex(accessToken, settings.tokenLifeTime, '1');\n            // Set headers required by the requester.\n            res.setHeader('token', accessToken);\n            res.setHeader('expires_in', settings.tokenLifeTime);\n            res.setHeader('Access-Control-Expose-Headers', 'token,expires_in,userid');\n        }\n    });\n\n    // proxy the request to the target service.\n    function sendToService(service, req, res) {\n        var url = req.url;\n        req.url = url.substr(service.path.length, url.length - service.path.length);\n        proxy.web(req, res, { target: service.upStream }, function(e) { console.error(e); });\n    }\n\n    function sendJson(obj, res) {\n        res.setHeader(\"Content-Type\", \"application/json\");\n        res.end(JSON.stringify(obj));\n    }\n\n    function sendNotAuthorized(res) {\n        res.statusCode = 401;\n        sendJson('You are not allowed to access this API!', res);\n    }\n\n    function sendNotFound(res) {\n        res.statusCode = 404;\n        sendJson('Could not find any resources for given path.', res);\n    }\n\n    function sendMethodNotAllowed(res) {\n        res.statusCode = 405;\n        sendJson('Method not allowed', res);\n    }\n\n    // Check CORS of the request\n    function CheckCors(service, req, res) {\n        // Set needed headers.\n        if (req.headers.origin) {\n            res.setHeader('Access-Control-Allow-Origin', req.headers.origin);\n        }\n        res.setHeader('Access-Control-Allow-Methods', service.allowedMethods);\n        res.setHeader('Access-Control-Allow-Headers', 'Authorization,Content-Type,Accept');\n        // Just send the response if the request is an POTIONS request.\n        if (req.method == 'OPTIONS') {\n            res.end();\n            return true;\n        }\n        return false;\n    }\n\n    var server = http.createServer(function(req, res) {\n        var origins = settings.origins;\n        var requestHeaders = req.headers;\n        var requestUrl = req.url.toLowerCase();\n        // If the allowed origins are declared in the settings.\n        if (origins) {\n            // Check the origin of the request and send a not authorized response if the request origin is not allowed.\n            if (!requestHeaders.origin || 0 \u003e origins.indexOf(requestHeaders.origin)) {\n                return sendNotAuthorized(res);\n            }\n        }\n        // If the request is for getting the token.\n        if (requestUrl.startsWith(TokenEndPoint)) {\n            // Set request property to check later in the response code.\n            req.tokenRequest = true;\n            // Change destination to the authentication endpoint in the authentication API.\n            req.url = settings.userAuthenticationPath;\n            if (!CheckCors({ allowedMethods: 'POST' }, req, res)) {\n                // Proxy the request.\n                proxy.web(req, res, { target: settings.authenticationServiceUrl }, function(e) { console.error(e); });\n            }\n        } else {\n            // Get the service.\n            var service = getServiceForPath(requestUrl);\n            if (!service) {\n                // If no service found for the request path, returns a not found.\n                return sendNotFound(res);\n            }\n            // If the method is not OPTIONS and method is not in the allowed methods list ,\n            // returns a not allowed response.\n            if (req.method != 'OPTIONS' \u0026\u0026 -1 \u003e service.allowedMethods.indexOf(req.method)) {\n                return sendMethodNotAllowed(res);\n            }\n            // If the service needs authentication.\n            if (service.authenticate) {\n                // Request must have the the authorization header.\n                if (requestHeaders.authorization) {\n                   // If Redis has a value for request's authentication header value.\n                    redisClient.exists(requestHeaders.authorization, function(err, reply) {\n                        if (reply === 1) {\n                            if (!CheckCors(service, req, res)) {\n                                // Proxy the request to the target service.\n                                return sendToService(service, req, res);\n                            }\n                        } else {\n                            // If not authenticated or token has expired , send a not authorized response.\n                            return sendNotAuthorized(res);\n                        }\n                    });\n                } else {\n                    // If authorization header does not exist , then send a not authorized response.\n                    return sendNotAuthorized(res);\n                }\n            } else {\n                // If the service does not need authentication , proxy the request to the target service.\n                if (!CheckCors(service, req, res)) {\n                    return sendToService(service, req, res);\n                }\n            }\n        }\n    });\n    // Listen to the port.\n    server.listen(settings.listen);\n})();\n```\n","parsedContent":"\u003cp\u003eThis is an API gateway implemented using \u003ca href=\"https://www.npmjs.com/package/httpp-proxy\"\u003eNode JS Proxy\u003c/a\u003e and \u003ca href=\"https://www.npmjs.com/package/redis\"\u003eRedis\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eThe use case was I Had to implement a service gateway for a microservice backend. I tried various open source API gateways but didn’t help with my requirements. some of my requirements was\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSome endpoints or APIs are secured while others aren’t\u003c/li\u003e\n\u003cli\u003eOne token can be used to access all secured endpoints\u003c/li\u003e\n\u003cli\u003eUsers should be authenticated using username and password\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThen i decided to do it my self without using an existing implementation. as a temporary solution. Here I Use Node JS to write the proxy . Node JS does a great job handling requests.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs js language-js\"\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;use strict\u0026quot;\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e http = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;http\u0026#x27;\u003c/span\u003e),\n        httpProxy = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;http-proxy\u0026#x27;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e redis = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;redis\u0026#x27;\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// We use redis to store tokens.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e redisClient = redis.\u003cspan class=\"hljs-title function_\"\u003ecreateClient\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e6379\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;localhost\u0026#x27;\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// Create the redis client.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e helpers = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;./base/helpers.js\u0026quot;\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// This module contains some helper functions.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTokenEndPoint\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/token\u0026#x27;\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// Endpoint of the token requests.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e settings = { \u003cspan class=\"hljs-comment\"\u003e// Settings used in the proxy  (can be from a file or database).\u003c/span\u003e\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;userAuthenticationPath\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/users/authenticate\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// The endpoint in the authentication API  which actually authenticates the user.\u003c/span\u003e\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;authenticationServiceUrl\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;http://authservice\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Hostname of the authentication service (API). \u003c/span\u003e\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;tokenLifeTime\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3600\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Lifetime of an access token.\u003c/span\u003e\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;origins\u0026quot;\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026quot;http://abc.com\u0026quot;\u003c/span\u003e], \u003cspan class=\"hljs-comment\"\u003e// Allowed origins.\u003c/span\u003e\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;listen\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5500\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Port to listen.\u003c/span\u003e\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;services\u0026quot;\u003c/span\u003e: [{  \u003cspan class=\"hljs-comment\"\u003e// List of services (APIs).\u003c/span\u003e\n              \u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Order Service\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Name of the service.\u003c/span\u003e\n              \u003cspan class=\"hljs-string\"\u003e\u0026quot;path\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/orders\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Paths belong to this service. \u003c/span\u003e\n              \u003cspan class=\"hljs-string\"\u003e\u0026quot;authenticate\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Only authorized users can access this API.\u003c/span\u003e\n              \u003cspan class=\"hljs-string\"\u003e\u0026quot;allowedMethods\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;GET,POST,PUT,DELETE\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Allowed HTTP verbs.\u003c/span\u003e\n              \u003cspan class=\"hljs-string\"\u003e\u0026quot;upStream\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;http://orderservice\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// Destination address of the API.\u003c/span\u003e\n          },\n          {\n              \u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;Item Service\u0026quot;\u003c/span\u003e,\n              \u003cspan class=\"hljs-string\"\u003e\u0026quot;path\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/items\u0026quot;\u003c/span\u003e,\n              \u003cspan class=\"hljs-string\"\u003e\u0026quot;authenticate\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Anyone can access this API.\u003c/span\u003e\n              \u003cspan class=\"hljs-string\"\u003e\u0026quot;allowedMethods\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;GET\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// Only GET is allowed.\u003c/span\u003e\n              \u003cspan class=\"hljs-string\"\u003e\u0026quot;upStream\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;http://itemservice\u0026quot;\u003c/span\u003e\n          }\n      ]\n    };\n\n    \u003cspan class=\"hljs-comment\"\u003e// This function gives the service for given base path.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetServiceForPath\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003epath\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e services = settings.\u003cspan class=\"hljs-property\"\u003eservices\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e i = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, sl = services.\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e; i \u0026lt; sl; i++) {\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (path.\u003cspan class=\"hljs-title function_\"\u003estartsWith\u003c/span\u003e(services[i].\u003cspan class=\"hljs-property\"\u003epath\u003c/span\u003e)) {\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e services[i];\n            }\n        }\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// Creates the proxy server.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e proxy = httpProxy.\u003cspan class=\"hljs-title function_\"\u003ecreateProxyServer\u003c/span\u003e({});\n\n    \u003cspan class=\"hljs-comment\"\u003e// Registers a function to call when a response is arrived.\u003c/span\u003e\n    proxy.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;proxyRes\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eproxyReq, req, res, options\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment\"\u003e// If the request is a token request (we set this property in the request code), we execute below code.\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e// Otherwise the response will be delivered to the requester as is.\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (req.\u003cspan class=\"hljs-property\"\u003etokenRequest\u003c/span\u003e \u0026amp;\u0026amp; proxyReq.\u003cspan class=\"hljs-property\"\u003estatusCode\u003c/span\u003e === \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e userId = proxyReq.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003euserid\u003c/span\u003e;\n            \u003cspan class=\"hljs-comment\"\u003e// Authentication API should set the userid header if the credentials are correct.\u003c/span\u003e\n            \u003cspan class=\"hljs-comment\"\u003e// If the header userid is not exists, we send a not authorized response the the requester. \u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!userId) {\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendNotAuthorized\u003c/span\u003e(res);\n            }\n            \u003cspan class=\"hljs-comment\"\u003e// Creates a GUID as an access token.\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e accessToken = helpers.\u003cspan class=\"hljs-title function_\"\u003eguid\u003c/span\u003e();\n            \u003cspan class=\"hljs-comment\"\u003e// Save the access token in Redis.\u003c/span\u003e\n            redisClient.\u003cspan class=\"hljs-title function_\"\u003esetex\u003c/span\u003e(accessToken, settings.\u003cspan class=\"hljs-property\"\u003etokenLifeTime\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;1\u0026#x27;\u003c/span\u003e);\n            \u003cspan class=\"hljs-comment\"\u003e// Set headers required by the requester.\u003c/span\u003e\n            res.\u003cspan class=\"hljs-title function_\"\u003esetHeader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;token\u0026#x27;\u003c/span\u003e, accessToken);\n            res.\u003cspan class=\"hljs-title function_\"\u003esetHeader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;expires_in\u0026#x27;\u003c/span\u003e, settings.\u003cspan class=\"hljs-property\"\u003etokenLifeTime\u003c/span\u003e);\n            res.\u003cspan class=\"hljs-title function_\"\u003esetHeader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Expose-Headers\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;token,expires_in,userid\u0026#x27;\u003c/span\u003e);\n        }\n    });\n\n    \u003cspan class=\"hljs-comment\"\u003e// proxy the request to the target service.\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendToService\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eservice, req, res\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e url = req.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e;\n        req.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e = url.\u003cspan class=\"hljs-title function_\"\u003esubstr\u003c/span\u003e(service.\u003cspan class=\"hljs-property\"\u003epath\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e, url.\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e - service.\u003cspan class=\"hljs-property\"\u003epath\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e);\n        proxy.\u003cspan class=\"hljs-title function_\"\u003eweb\u003c/span\u003e(req, res, { \u003cspan class=\"hljs-attr\"\u003etarget\u003c/span\u003e: service.\u003cspan class=\"hljs-property\"\u003eupStream\u003c/span\u003e }, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) { \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(e); });\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendJson\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eobj, res\u003c/span\u003e) {\n        res.\u003cspan class=\"hljs-title function_\"\u003esetHeader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;Content-Type\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;application/json\u0026quot;\u003c/span\u003e);\n        res.\u003cspan class=\"hljs-title function_\"\u003eend\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estringify\u003c/span\u003e(obj));\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendNotAuthorized\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) {\n        res.\u003cspan class=\"hljs-property\"\u003estatusCode\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e401\u003c/span\u003e;\n        \u003cspan class=\"hljs-title function_\"\u003esendJson\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;You are not allowed to access this API!\u0026#x27;\u003c/span\u003e, res);\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendNotFound\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) {\n        res.\u003cspan class=\"hljs-property\"\u003estatusCode\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e404\u003c/span\u003e;\n        \u003cspan class=\"hljs-title function_\"\u003esendJson\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Could not find any resources for given path.\u0026#x27;\u003c/span\u003e, res);\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendMethodNotAllowed\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) {\n        res.\u003cspan class=\"hljs-property\"\u003estatusCode\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e405\u003c/span\u003e;\n        \u003cspan class=\"hljs-title function_\"\u003esendJson\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Method not allowed\u0026#x27;\u003c/span\u003e, res);\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// Check CORS of the request\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eCheckCors\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eservice, req, res\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment\"\u003e// Set needed headers.\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (req.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eorigin\u003c/span\u003e) {\n            res.\u003cspan class=\"hljs-title function_\"\u003esetHeader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Origin\u0026#x27;\u003c/span\u003e, req.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eorigin\u003c/span\u003e);\n        }\n        res.\u003cspan class=\"hljs-title function_\"\u003esetHeader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Methods\u0026#x27;\u003c/span\u003e, service.\u003cspan class=\"hljs-property\"\u003eallowedMethods\u003c/span\u003e);\n        res.\u003cspan class=\"hljs-title function_\"\u003esetHeader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Headers\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Authorization,Content-Type,Accept\u0026#x27;\u003c/span\u003e);\n        \u003cspan class=\"hljs-comment\"\u003e// Just send the response if the request is an POTIONS request.\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (req.\u003cspan class=\"hljs-property\"\u003emethod\u003c/span\u003e == \u003cspan class=\"hljs-string\"\u003e\u0026#x27;OPTIONS\u0026#x27;\u003c/span\u003e) {\n            res.\u003cspan class=\"hljs-title function_\"\u003eend\u003c/span\u003e();\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e server = http.\u003cspan class=\"hljs-title function_\"\u003ecreateServer\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ereq, res\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e origins = settings.\u003cspan class=\"hljs-property\"\u003eorigins\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e requestHeaders = req.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e requestUrl = req.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003etoLowerCase\u003c/span\u003e();\n        \u003cspan class=\"hljs-comment\"\u003e// If the allowed origins are declared in the settings.\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (origins) {\n            \u003cspan class=\"hljs-comment\"\u003e// Check the origin of the request and send a not authorized response if the request origin is not allowed.\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!requestHeaders.\u003cspan class=\"hljs-property\"\u003eorigin\u003c/span\u003e || \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u0026gt; origins.\u003cspan class=\"hljs-title function_\"\u003eindexOf\u003c/span\u003e(requestHeaders.\u003cspan class=\"hljs-property\"\u003eorigin\u003c/span\u003e)) {\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendNotAuthorized\u003c/span\u003e(res);\n            }\n        }\n        \u003cspan class=\"hljs-comment\"\u003e// If the request is for getting the token.\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (requestUrl.\u003cspan class=\"hljs-title function_\"\u003estartsWith\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eTokenEndPoint\u003c/span\u003e)) {\n            \u003cspan class=\"hljs-comment\"\u003e// Set request property to check later in the response code.\u003c/span\u003e\n            req.\u003cspan class=\"hljs-property\"\u003etokenRequest\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n            \u003cspan class=\"hljs-comment\"\u003e// Change destination to the authentication endpoint in the authentication API.\u003c/span\u003e\n            req.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e = settings.\u003cspan class=\"hljs-property\"\u003euserAuthenticationPath\u003c/span\u003e;\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-title class_\"\u003eCheckCors\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003eallowedMethods\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;POST\u0026#x27;\u003c/span\u003e }, req, res)) {\n                \u003cspan class=\"hljs-comment\"\u003e// Proxy the request.\u003c/span\u003e\n                proxy.\u003cspan class=\"hljs-title function_\"\u003eweb\u003c/span\u003e(req, res, { \u003cspan class=\"hljs-attr\"\u003etarget\u003c/span\u003e: settings.\u003cspan class=\"hljs-property\"\u003eauthenticationServiceUrl\u003c/span\u003e }, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) { \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(e); });\n            }\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n            \u003cspan class=\"hljs-comment\"\u003e// Get the service.\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e service = \u003cspan class=\"hljs-title function_\"\u003egetServiceForPath\u003c/span\u003e(requestUrl);\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!service) {\n                \u003cspan class=\"hljs-comment\"\u003e// If no service found for the request path, returns a not found.\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendNotFound\u003c/span\u003e(res);\n            }\n            \u003cspan class=\"hljs-comment\"\u003e// If the method is not OPTIONS and method is not in the allowed methods list ,\u003c/span\u003e\n            \u003cspan class=\"hljs-comment\"\u003e// returns a not allowed response.\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (req.\u003cspan class=\"hljs-property\"\u003emethod\u003c/span\u003e != \u003cspan class=\"hljs-string\"\u003e\u0026#x27;OPTIONS\u0026#x27;\u003c/span\u003e \u0026amp;\u0026amp; -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u0026gt; service.\u003cspan class=\"hljs-property\"\u003eallowedMethods\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eindexOf\u003c/span\u003e(req.\u003cspan class=\"hljs-property\"\u003emethod\u003c/span\u003e)) {\n                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendMethodNotAllowed\u003c/span\u003e(res);\n            }\n            \u003cspan class=\"hljs-comment\"\u003e// If the service needs authentication.\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (service.\u003cspan class=\"hljs-property\"\u003eauthenticate\u003c/span\u003e) {\n                \u003cspan class=\"hljs-comment\"\u003e// Request must have the the authorization header.\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (requestHeaders.\u003cspan class=\"hljs-property\"\u003eauthorization\u003c/span\u003e) {\n                   \u003cspan class=\"hljs-comment\"\u003e// If Redis has a value for request\u0026#x27;s authentication header value.\u003c/span\u003e\n                    redisClient.\u003cspan class=\"hljs-title function_\"\u003eexists\u003c/span\u003e(requestHeaders.\u003cspan class=\"hljs-property\"\u003eauthorization\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, reply\u003c/span\u003e) {\n                        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (reply === \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\n                            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-title class_\"\u003eCheckCors\u003c/span\u003e(service, req, res)) {\n                                \u003cspan class=\"hljs-comment\"\u003e// Proxy the request to the target service.\u003c/span\u003e\n                                \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendToService\u003c/span\u003e(service, req, res);\n                            }\n                        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                            \u003cspan class=\"hljs-comment\"\u003e// If not authenticated or token has expired , send a not authorized response.\u003c/span\u003e\n                            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendNotAuthorized\u003c/span\u003e(res);\n                        }\n                    });\n                } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                    \u003cspan class=\"hljs-comment\"\u003e// If authorization header does not exist , then send a not authorized response.\u003c/span\u003e\n                    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendNotAuthorized\u003c/span\u003e(res);\n                }\n            } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                \u003cspan class=\"hljs-comment\"\u003e// If the service does not need authentication , proxy the request to the target service.\u003c/span\u003e\n                \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-title class_\"\u003eCheckCors\u003c/span\u003e(service, req, res)) {\n                    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esendToService\u003c/span\u003e(service, req, res);\n                }\n            }\n        }\n    });\n    \u003cspan class=\"hljs-comment\"\u003e// Listen to the port.\u003c/span\u003e\n    server.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(settings.\u003cspan class=\"hljs-property\"\u003elisten\u003c/span\u003e);\n})();\n\u003c/code\u003e\u003c/pre\u003e"},"page":"Post","topTags":["programming","aws","web","machineLearning","react","javascript","dataScience","typescript","r","csharp"],"relatedPosts":[{"title":"React Form Validation Using Custom Hooks","tags":["web","programming","react","javascript"],"fullUrl":"https://rusith.me/blog/react-form-validation-using-custom-hooks","date":"Mon, Jun 24, 2019","description":"Form validation in react is bit tricky. This is an attempt to make it bit easy by using react hooks. here we write few custom hooks to create a re-usable validation logic that can be used in any form.","banner":null},{"title":"Testing Redux Connected React Components Using Jest","tags":["programming","javascript","react","redux","testing","jest"],"fullUrl":"https://rusith.me/blog/testing-react-redux-connected-components-using-jest","date":"Mon, Apr 27, 2020","description":"Testing React components connected to a Redux store using Jest and React Testing Library.","banner":"/post-data/2020-04-27-testing-redux-connect/banner.png"},{"title":"Deploying a Website on S3 With SSL, Continuous Integration","tags":["aws","programming","web"],"fullUrl":"https://rusith.me/blog/building-a-website-on-s3","date":"Mon, Aug 5, 2019","description":"In this post, I am creating a website and host it on S3 and setup a continuous integration pipeline setup using Gitlab","banner":"/post-data/2019-08-14-building-a-website-on-s3/banner.png"}]},"__N_SSG":true},"page":"/[[...path]]","query":{"path":["2018","03","15","node-service-gateway"]},"buildId":"PaoTT2YDvwYY_jbobaNoC","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>